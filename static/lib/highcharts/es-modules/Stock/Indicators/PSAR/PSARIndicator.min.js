"use strict";import SeriesRegistry from"../../../Core/Series/SeriesRegistry.js";const SMAIndicator=SeriesRegistry.seriesTypes["sma"];import U from"../../../Core/Utilities.js";const merge=U["merge"];function toFixed(t,e){return parseFloat(t.toFixed(e))}function calculateDirection(t,e,i,r){return 1===t&&r<e||-1===t&&r<i?1:-1}function getAccelerationFactor(t,e,i,r,n,a,o,c){return t===e?1===t&&r<i||-1===t&&i<r?n===o?o:toFixed(n+a,2):n:c}function getExtremePoint(t,e,i,r){return 1===i?r<t?t:r:e<r?e:r}function getEPMinusPSAR(t,e){return t-e}function getAccelerationFactorMultiply(t,e){return t*e}function getPSAR(t,e,i,r,n,a,o,c,l){return t===e?1===t?i+r<Math.min(n,a)?i+r:Math.min(n,a):i+r>Math.max(c,o)?i+r:Math.max(c,o):l}class PSARIndicator extends SMAIndicator{constructor(){super(...arguments),this.nameComponents=void 0}getValues(t,e){const i=t.xData,r=t.yData,n=e.maxAccelerationFactor,a=e.increment,o=e.initialAccelerationFactor,c=e.decimals,l=e.index,s=[],u=[],d=[];let m=e.initialAccelerationFactor,g,A=r[0][1],p,x,F,h=1,S,f,M,P,R=r[0][2],y,I,D,E;if(!(l>=r.length)){for(E=0;E<l;E++)A=Math.max(r[E][1],A),R=Math.min(r[E][2],toFixed(R,c));for(g=r[E][1]>R?1:-1,p=getEPMinusPSAR(A,R),m=e.initialAccelerationFactor,x=getAccelerationFactorMultiply(m,p),s.push([i[l],R]),u.push(i[l]),d.push(toFixed(R,c)),E=l+1;E<r.length;E++)S=r[E-1][2],f=r[E-2][2],M=r[E-1][1],P=r[E-2][1],I=r[E][1],D=r[E][2],null!==f&&null!==P&&null!==S&&null!==M&&null!==I&&null!==D&&(R=getPSAR(g,h,R,x,f,S,M,P,A),y=getExtremePoint(I,D,g,A),F=calculateDirection(h,D,I,R),m=getAccelerationFactor(F,g,y,A,m,a,n,o),p=getEPMinusPSAR(y,R),x=getAccelerationFactorMultiply(m,p),s.push([i[E],toFixed(R,c)]),u.push(i[E]),d.push(toFixed(R,c)),h=g,g=F,A=y);return{values:s,xData:u,yData:d}}}}PSARIndicator.defaultOptions=merge(SMAIndicator.defaultOptions,{lineWidth:0,marker:{enabled:!0},states:{hover:{lineWidthPlus:0}},params:{period:void 0,initialAccelerationFactor:.02,maxAccelerationFactor:.2,increment:.02,index:2,decimals:4}}),SeriesRegistry.registerSeriesType("psar",PSARIndicator);export default PSARIndicator;