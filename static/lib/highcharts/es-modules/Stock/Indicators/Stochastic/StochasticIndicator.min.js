"use strict";import AU from"../ArrayUtilities.js";import MultipleLinesComposition from"../MultipleLinesComposition.js";import SeriesRegistry from"../../../Core/Series/SeriesRegistry.js";const SMAIndicator=SeriesRegistry.seriesTypes["sma"];import U from"../../../Core/Utilities.js";const{extend,isArray,merge}=U;class StochasticIndicator extends SMAIndicator{init(){super.init.apply(this,arguments),this.options=merge({smoothedLine:{styles:{lineColor:this.color}}},this.options)}getValues(e,t){const i=t.periods[0],s=t.periods[1],o=e.xData,r=e.yData,a=r?r.length:0,n=[],p=[],l=[];let c,d,m,y=null,h,u,S;if(!(a<i)&&isArray(r[0])&&4===r[0].length){let e=!0,t=0;for(S=i-1;S<a;S++){var g;c=r.slice(S-i+1,S+1),d=(u=AU.getArrayExtremes(c,2,1))[0],m=(r[S][3]-d)/(u[1]-d)*100,isNaN(m)&&e?t++:(e&&!isNaN(m)&&(e=!1),g=p.push(o[S]),isNaN(m)?l.push([l[g-2]&&"number"==typeof l[g-2][0]?l[g-2][0]:null,null]):l.push([m,null]),S>=t+(i-1)+(s-1)&&(h=super.getValues({xData:p.slice(-s),yData:l.slice(-s)},{period:s}),y=h.yData[0]),n.push([o[S],m,y]),l[g-1][1]=y)}return{values:n,xData:p,yData:l}}}}StochasticIndicator.defaultOptions=merge(SMAIndicator.defaultOptions,{params:{index:void 0,period:void 0,periods:[14,3]},marker:{enabled:!1},tooltip:{pointFormat:'<span style="color:{point.color}">‚óè</span><b> {series.name}</b><br/>%K: {point.y}<br/>%D: {point.smoothed}<br/>'},smoothedLine:{styles:{lineWidth:1,lineColor:void 0}},dataGrouping:{approximation:"averages"}}),extend(StochasticIndicator.prototype,{areaLinesNames:[],nameComponents:["periods"],nameBase:"Stochastic",pointArrayMap:["y","smoothed"],parallelArrays:["x","y","smoothed"],pointValKey:"y",linesApiNames:["smoothedLine"]}),MultipleLinesComposition.compose(StochasticIndicator),SeriesRegistry.registerSeriesType("stochastic",StochasticIndicator);export default StochasticIndicator;