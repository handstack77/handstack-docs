"use strict";import D from"../../Core/Defaults.js";const defaultOptions=D["defaultOptions"];import H from"../../Core/Globals.js";const composed=H["composed"];import RangeSelectorDefaults from"./RangeSelectorDefaults.js";import U from"../../Core/Utilities.js";const{addEvent,defined,extend,isNumber,merge,pick,pushUnique}=U,chartDestroyEvents=[];let RangeSelectorConstructor;function axisMinFromRange(){function e(e,t){var o="year"===i?"FullYear":"Month";const r=new a.Date(e);var n=a.get(o,r);return a.set(o,r,n+t),n===a.get(o,r)&&a.set("Date",r,0),r.getTime()-e}const t=this.range,i=t.type,o=this.max,a=this.chart.time;let r,n;isNumber(t)?(r=o-t,n=t):t&&(r=o+e(o,-(t.count||1)),this.chart&&this.chart.setFixedRange(o-r));var s=pick(this.dataMin,Number.MIN_VALUE);return(r=isNumber(r)?r:s)<=s&&(r=s,void 0===n&&(n=e(r,t.count)),this.newMax=Math.min(r+n,pick(this.dataMax,Number.MAX_VALUE))),isNumber(o)?!isNumber(t)&&t&&t._offsetMin&&(r+=t._offsetMin):r=void 0,r}function compose(e,t,o){if(RangeSelectorConstructor=o,pushUnique(composed,"RangeSelector")){const r=t.prototype;e.prototype.minFromRange=axisMinFromRange,addEvent(t,"afterGetContainer",createRangeSelector),addEvent(t,"beforeRender",onChartBeforeRender),addEvent(t,"destroy",onChartDestroy),addEvent(t,"getMargins",onChartGetMargins),addEvent(t,"redraw",redrawRangeSelector),addEvent(t,"update",onChartUpdate),r.callbacks.push(redrawRangeSelector),extend(defaultOptions,{rangeSelector:RangeSelectorDefaults.rangeSelector}),extend(defaultOptions.lang,RangeSelectorDefaults.lang)}}function createRangeSelector(){this.options.rangeSelector&&this.options.rangeSelector.enabled&&(this.rangeSelector=new RangeSelectorConstructor(this))}function onChartBeforeRender(){const e=this.rangeSelector;var t;e&&(isNumber(e.deferredYTDClick)&&(e.clickButton(e.deferredYTDClick),delete e.deferredYTDClick),t=e.options.verticalAlign,e.options.floating||("bottom"===t?this.extraBottomMargin=!0:"middle"!==t&&(this.extraTopMargin=!0)))}function redrawRangeSelector(){var t=this;const o=this.rangeSelector;if(o){let e;var r=t.xAxis[0].getExtremes();const i=t.legend;var n=o&&o.options.verticalAlign;isNumber(r.min)&&o.render(r.min,r.max),i.display&&"top"===n&&n===i.options.verticalAlign&&(e=merge(t.spacingBox),"vertical"===i.options.layout?e.y=t.plotTop:e.y+=o.getHeight(),i.group.placed=!1,i.align(e))}}function onChartDestroy(){for(let e=0,t=chartDestroyEvents.length;e<t;++e){const o=chartDestroyEvents[e];if(o[0]===this)return o[1].forEach(e=>e()),void chartDestroyEvents.splice(e,1)}}function onChartGetMargins(){const e=this.rangeSelector;var t;e&&(t=e.getHeight(),this.extraTopMargin&&(this.plotTop+=t),this.extraBottomMargin&&(this.marginBottom+=t))}function onChartUpdate(e){var e=e.options.rangeSelector,t=this.extraBottomMargin,o=this.extraTopMargin;let r=this.rangeSelector;e&&e.enabled&&!defined(r)&&this.options.rangeSelector&&(this.options.rangeSelector.enabled=!0,this.rangeSelector=r=new RangeSelectorConstructor(this)),this.extraBottomMargin=!1,this.extraTopMargin=!1,r&&(e=e&&e.verticalAlign||r.options&&r.options.verticalAlign,r.options.floating||("bottom"===e?this.extraBottomMargin=!0:"middle"!==e&&(this.extraTopMargin=!0)),this.extraBottomMargin===t&&this.extraTopMargin===o||(this.isDirtyBox=!0))}const RangeSelectorComposition={compose:compose};export default RangeSelectorComposition;