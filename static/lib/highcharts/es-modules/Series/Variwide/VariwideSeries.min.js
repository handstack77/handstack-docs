"use strict";import SeriesRegistry from"../../Core/Series/SeriesRegistry.js";const ColumnSeries=SeriesRegistry.seriesTypes["column"];import VariwideComposition from"./VariwideComposition.js";import VariwidePoint from"./VariwidePoint.js";import VariwideSeriesDefaults from"./VariwideSeriesDefaults.js";import U from"../../Core/Utilities.js";const{addEvent,crisp,extend,merge,pick}=U;class VariwideSeries extends ColumnSeries{processData(i){this.totalZ=0,this.relZ=[],SeriesRegistry.seriesTypes.column.prototype.processData.call(this,i),(this.xAxis.reversed?this.zData.slice().reverse():this.zData).forEach(function(i,t){this.relZ[t]=this.totalZ,this.totalZ+=i},this),this.xAxis.categories&&(this.xAxis.variwide=!0,this.xAxis.zData=this.zData)}postTranslate(i,t,e){const s=this.xAxis,r=this.relZ,o=s.reversed?r.length-i:i,a=s.reversed?-1:1,n=s.toPixels(s.reversed?(s.dataMax||0)+s.pointRange:s.dataMin||0),p=s.toPixels(s.reversed?s.dataMin||0:(s.dataMax||0)+s.pointRange),h=Math.abs(p-n),d=this.totalZ,l=this.chart.inverted?p-(this.chart.plotTop-a*s.minPixelPadding):n-this.chart.plotLeft-a*s.minPixelPadding,c=o/r.length*h,x=(o+a)/r.length*h,m=pick(r[o],d)/d*h,w=pick(r[o+a],d)/d*h,S=t-(l+c);return e&&(e.crosshairWidth=w-m),l+m+S*(w-m)/(x-c)}translate(){this.crispOption=this.options.crisp,this.options.crisp=!1,super.translate(),this.options.crisp=this.crispOption}correctStackLabels(){var i=this,t=i.options,e=i.yAxis;let s,r,o,a;for(const n of i.points)a=n.x,r=n.shapeArgs.width,(o=e.stacking.stacks[(i.negStacks&&n.y<(t.startFromThreshold?0:t.threshold)?"-":"")+i.stackKey])&&(s=o[a])&&!n.isNull&&s.setOffset(-r/2||0,r||0,void 0,void 0,n.plotX,i.xAxis)}}VariwideSeries.compose=VariwideComposition.compose,VariwideSeries.defaultOptions=merge(ColumnSeries.defaultOptions,VariwideSeriesDefaults),addEvent(VariwideSeries,"afterColumnTranslate",function(){const e=this.xAxis,s=this.chart.inverted;let r=-1;for(const o of this.points){++r;const a=o.shapeArgs||{},{x:n=0,width:p=0}=a,{plotX:h=0,tooltipPos:d,z:l=0}=o;let i,t;t=e.variwide?(i=this.postTranslate(r,n,o),this.postTranslate(r,n+p)):(i=h,e.translate(o.x+l,!1,!1,!1,!0)),this.crispOption&&(i=crisp(i,this.borderWidth),t=crisp(t,this.borderWidth)),a.x=i,a.width=Math.max(t-i,1),o.plotX=(i+t)/2,d&&(s?d[1]=e.len-a.x-a.width/2:d[0]=a.x+a.width/2)}this.options.stacking&&this.correctStackLabels()},{order:2}),extend(VariwideSeries.prototype,{irregularWidths:!0,pointArrayMap:["y","z"],parallelArrays:["x","y","z"],pointClass:VariwidePoint}),SeriesRegistry.registerSeriesType("variwide",VariwideSeries);export default VariwideSeries;