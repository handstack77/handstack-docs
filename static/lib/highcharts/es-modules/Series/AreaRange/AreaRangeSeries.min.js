"use strict";import AreaRangePoint from"./AreaRangePoint.js";import H from"../../Core/Globals.js";const noop=H["noop"];import SeriesRegistry from"../../Core/Series/SeriesRegistry.js";const{area:AreaSeries,area:{prototype:areaProto},column:{prototype:columnProto}}=SeriesRegistry.seriesTypes;import U from"../../Core/Utilities.js";const{addEvent,defined,extend,isArray,isNumber,pick,merge}=U,areaRangeSeriesOptions={lineWidth:1,threshold:null,tooltip:{pointFormat:'<span style="color:{series.color}">‚óè</span> {series.name}: <b>{point.low}</b> - <b>{point.high}</b><br/>'},trackByArea:!0,dataLabels:{align:void 0,verticalAlign:void 0,xLow:0,xHigh:0,yLow:0,yHigh:0}};class AreaRangeSeries extends AreaSeries{toYData(t){return[t.low,t.high]}highToXY(t){var e=this.chart,o=this.xAxis.postTranslate(t.rectPlotX||0,this.yAxis.len-(t.plotHigh||0));t.plotHighX=o.x-e.plotLeft,t.plotHigh=o.y-e.plotTop,t.plotLowX=t.plotX}getGraphPath(t){const e=[],o=[],a=areaProto.getGraphPath,r=this.options,i=this.chart.polar,s=i&&!1!==r.connectEnds,l=r.connectNulls;let p,n,h,g=r.step;for(t=t||this.points,p=t.length;p--;){n=t[p];var d=i?{plotX:n.rectPlotX,plotY:n.yBottom,doCurve:!1}:{plotX:n.plotX,plotY:n.plotY,doCurve:!1};n.isNull||s||l||t[p+1]&&!t[p+1].isNull||o.push(d),h={polarPlotY:n.polarPlotY,rectPlotX:n.rectPlotX,yBottom:n.yBottom,plotX:pick(n.plotHighX,n.plotX),plotY:n.plotHigh,isNull:n.isNull},o.push(h),e.push(h),n.isNull||s||l||t[p-1]&&!t[p-1].isNull||o.push(d)}const c=a.call(this,t);g&&(!0===g&&(g="left"),r.step={left:"right",center:"center",right:"left"}[g]);var y=a.call(this,e);const b=a.call(this,o),f=(r.step=g,[].concat(c,y));return!this.chart.polar&&b[0]&&"M"===b[0][0]&&(b[0]=["L",b[0][1],b[0][2]]),this.graphPath=f,this.areaPath=c.concat(b),f.isArea=!0,f.xMap=c.xMap,this.areaPath.xMap=c.xMap,f}drawDataLabels(){const t=this.points,e=t.length,o=[],a=this.options.dataLabels,r=this.chart.inverted;let i,s,l,p,n;if(a){if(isArray(a)?(p=a[0]||{enabled:!1},n=a[1]||{enabled:!1}):((p=extend({},a)).x=a.xHigh,p.y=a.yHigh,(n=extend({},a)).x=a.xLow,n.y=a.yLow),p.enabled||this.hasDataLabels?.()){for(i=e;i--;){var h,g;(s=t[i])&&({plotHigh:h=0,plotLow:g=0}=s,l=p.inside?h<g:g<h,s.y=s.high,s._plotY=s.plotY,s.plotY=h,o[i]=s.dataLabel,s.dataLabel=s.dataLabelUpper,s.below=l,r?p.align||(p.align=l?"right":"left"):p.verticalAlign||(p.verticalAlign=l?"top":"bottom"))}for(this.options.dataLabels=p,areaProto.drawDataLabels&&areaProto.drawDataLabels.apply(this,arguments),i=e;i--;)(s=t[i])&&(s.dataLabelUpper=s.dataLabel,s.dataLabel=o[i],delete s.dataLabels,s.y=s.low,s.plotY=s._plotY)}if(n.enabled||this.hasDataLabels?.()){for(i=e;i--;){var d,c;(s=t[i])&&({plotHigh:d=0,plotLow:c=0}=s,l=n.inside?d<c:c<d,s.below=!l,r?n.align||(n.align=l?"left":"right"):n.verticalAlign||(n.verticalAlign=l?"bottom":"top"))}this.options.dataLabels=n,areaProto.drawDataLabels&&areaProto.drawDataLabels.apply(this,arguments)}if(p.enabled)for(i=e;i--;)(s=t[i])&&(s.dataLabels=[s.dataLabelUpper,s.dataLabel].filter(function(t){return!!t}));this.options.dataLabels=a}}alignDataLabel(){columnProto.alignDataLabel.apply(this,arguments)}modifyMarkerSettings(){var t,e,o=this,a={marker:o.options.marker,symbol:o.symbol};return o.options.lowMarker&&({marker:t,lowMarker:e}=o["options"],o.options.marker=merge(t,e),e.symbol&&(o.symbol=e.symbol)),a}restoreMarkerSettings(t){this.options.marker=t.marker,this.symbol=t.symbol}drawPoints(){var t=this,e=t.points.length;let o,a;var r=t.modifyMarkerSettings();for(areaProto.drawPoints.apply(t,arguments),t.restoreMarkerSettings(r),o=0;o<e;)(a=t.points[o]).graphics=a.graphics||[],a.origProps={plotY:a.plotY,plotX:a.plotX,isInside:a.isInside,negative:a.negative,zone:a.zone,y:a.y},(a.graphic||a.graphics[0])&&(a.graphics[0]=a.graphic),a.graphic=a.graphics[1],a.plotY=a.plotHigh,defined(a.plotHighX)&&(a.plotX=a.plotHighX),a.y=pick(a.high,a.origProps.y),a.negative=a.y<(t.options.threshold||0),t.zones.length&&(a.zone=a.getZone()),t.chart.polar||(a.isInside=a.isTopInside=void 0!==a.plotY&&0<=a.plotY&&a.plotY<=t.yAxis.len&&0<=a.plotX&&a.plotX<=t.xAxis.len),o++;for(areaProto.drawPoints.apply(t,arguments),o=0;o<e;)(a=t.points[o]).graphics=a.graphics||[],(a.graphic||a.graphics[1])&&(a.graphics[1]=a.graphic),a.graphic=a.graphics[0],a.origProps&&(extend(a,a.origProps),delete a.origProps),o++}hasMarkerChanged(t,e){var o=t.lowMarker,a=e.lowMarker||{};return o&&(!1===o.enabled||a.symbol!==o.symbol||a.height!==o.height||a.width!==o.width)||super.hasMarkerChanged(t,e)}}AreaRangeSeries.defaultOptions=merge(AreaSeries.defaultOptions,areaRangeSeriesOptions),addEvent(AreaRangeSeries,"afterTranslate",function(){"low,high"===this.pointArrayMap.join(",")&&this.points.forEach(t=>{var e=t.high,o=t.plotY;t.isNull?t.plotY=void 0:(t.plotLow=o,t.plotHigh=isNumber(e)?this.yAxis.translate(this.dataModify?this.dataModify.modifyValue(e):e,!1,!0,void 0,!0):void 0,this.dataModify&&(t.yBottom=t.plotHigh))})},{order:0}),addEvent(AreaRangeSeries,"afterTranslate",function(){this.points.forEach(t=>{if(this.chart.polar)this.highToXY(t),t.plotLow=t.plotY,t.tooltipPos=[((t.plotHighX||0)+(t.plotLowX||0))/2,((t.plotHigh||0)+(t.plotLow||0))/2];else{const e=t.pos(!1,t.plotLow),o=t.pos(!1,t.plotHigh);e&&o&&(e[0]=(e[0]+o[0])/2,e[1]=(e[1]+o[1])/2),t.tooltipPos=e}})},{order:3}),extend(AreaRangeSeries.prototype,{deferTranslatePolar:!0,pointArrayMap:["low","high"],pointClass:AreaRangePoint,pointValKey:"low",setStackedPoints:noop}),SeriesRegistry.registerSeriesType("arearange",AreaRangeSeries);export default AreaRangeSeries;