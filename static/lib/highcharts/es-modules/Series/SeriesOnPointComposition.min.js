"use strict";import H from"../Core/Globals.js";const composed=H["composed"];import Point from"../Core/Series/Point.js";import Series from"../Core/Series/Series.js";import SeriesRegistry from"../Core/Series/SeriesRegistry.js";const bubble=SeriesRegistry.seriesTypes["bubble"];import SVGRenderer from"../Core/Renderer/SVG/SVGRenderer.js";import U from"../Core/Utilities.js";const{addEvent,defined,find,isNumber,pushUnique}=U;var SeriesOnPointComposition;!function(e){e.compose=function(e,t){var i,o,s,r,n,d;return pushUnique(composed,"SeriesOnPoint")&&({chartGetZData:i,seriesAfterInit:o,seriesAfterRender:s,seriesGetCenter:r,seriesShowOrHide:n,seriesTranslate:d}=a.prototype,e.types.pie.prototype.onPointSupported=!0,addEvent(e,"afterInit",o),addEvent(e,"afterRender",s),addEvent(e,"afterGetCenter",r),addEvent(e,"hide",n),addEvent(e,"show",n),addEvent(e,"translate",d),addEvent(t,"beforeRender",i),addEvent(t,"beforeRedraw",i)),e};class a{constructor(e){this.getRadii=bubble.prototype.getRadii,this.getRadius=bubble.prototype.getRadius,this.getPxExtremes=bubble.prototype.getPxExtremes,this.getZExtremes=bubble.prototype.getZExtremes,this.chart=e.chart,this.series=e,this.options=e.options.onPoint}drawConnector(){this.connector||(this.connector=this.series.chart.renderer.path().addClass("highcharts-connector-seriesonpoint").attr({zIndex:-1}).add(this.series.markerGroup));var e=this.getConnectorAttributes();e&&this.connector.animate(e)}getConnectorAttributes(){const e=this.series.chart,t=this.options;if(t){var i=t.connectorOptions||{},o=t.position,s=e.get(t.id);if(s instanceof Point&&o&&defined(s.plotX)&&defined(s.plotY)){const r=defined(o.x)?o.x:s.plotX,n=defined(o.y)?o.y:s.plotY,d=r+(o.offsetX||0),a=n+(o.offsetY||0),h=i.width||1,p=i.stroke||this.series.color,c=i.dashstyle,f={d:SVGRenderer.prototype.crispLine([["M",r,n],["L",d,a]],h),"stroke-width":h};return e.styledMode||(f.stroke=p,f.dashstyle=c),f}}}seriesAfterInit(){this.onPointSupported&&this.options.onPoint&&(this.bubblePadding=!0,this.useMapGeometry=!0,this.onPoint=new a(this))}seriesAfterRender(){delete this.chart.bubbleZExtremes,this.onPoint&&this.onPoint.drawConnector()}seriesGetCenter(e){const t=this.options.onPoint,i=e.positions;t&&((o=this.chart.get(t.id))instanceof Point&&defined(o.plotX)&&defined(o.plotY)&&(i[0]=o.plotX,i[1]=o.plotY),(o=t.position)&&(defined(o.x)&&(i[0]=o.x),defined(o.y)&&(i[1]=o.y),o.offsetX&&(i[0]+=o.offsetX),o.offsetY&&(i[1]+=o.offsetY)));var o=this.radii&&this.radii[this.index];isNumber(o)&&(i[2]=2*o),e.positions=i}seriesShowOrHide(){const i=this.chart.series;this.points?.forEach(t=>{const e=find(i,e=>{e=((e.onPoint||{}).options||{}).id;return!!e&&e===t.id});e&&e.setVisible(!e.visible,!1)})}seriesTranslate(){this.onPoint&&(this.onPoint.getRadii(),this.radii=this.onPoint.radii)}chartGetZData(){const t=[];this.series.forEach(e=>{e=e.options.onPoint;t.push(e&&e.z?e.z:null)}),this.series.forEach(e=>{e.onPoint&&(e.onPoint.zData=e.zData=t)})}}e.Additions=a}(SeriesOnPointComposition=SeriesOnPointComposition||{});export default SeriesOnPointComposition;