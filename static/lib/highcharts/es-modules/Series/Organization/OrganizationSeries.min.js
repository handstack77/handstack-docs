"use strict";import OrganizationPoint from"./OrganizationPoint.js";import OrganizationSeriesDefaults from"./OrganizationSeriesDefaults.js";import SeriesRegistry from"../../Core/Series/SeriesRegistry.js";import PathUtilities from"../PathUtilities.js";const SankeySeries=SeriesRegistry.seriesTypes["sankey"];import U from"../../Core/Utilities.js";const{css,crisp,extend,isNumber,merge,pick}=U;import SVGElement from"../../Core/Renderer/SVG/SVGElement.js";import TextPath from"../../Extensions/TextPath.js";TextPath.compose(SVGElement);class OrganizationSeries extends SankeySeries{alignDataLabel(t,s,n){t=t.shapeArgs;if(n.useHTML&&t){n=this.options.borderWidth+2*this.options.dataLabels.padding;let i=t.width||0,e=t.height||0;this.chart.inverted&&(i=e,e=t.width||0),e-=n,i-=n;t=s.text;t&&(css(t.element.parentNode,{width:i+"px",height:e+"px"}),css(t.element,{left:0,top:0,width:"100%",height:"100%",overflow:"hidden"})),s.getBBox=()=>({width:i,height:e,x:0,y:0}),s.width=i,s.height=e}super.alignDataLabel.apply(this,arguments)}createNode(i){const e=super.createNode.call(this,i);return e.getSum=()=>1,e}pointAttribs(i,e){const t=this,s=SankeySeries.prototype.pointAttribs.call(t,i,e),n=(i.isNode?i:i.fromNode).level,r=t.mapOptionsToLevel[n||0]||{},a=i.options,o=r.states&&r.states[e]||{},h=pick(o.borderRadius,a.borderRadius,r.borderRadius,t.options.borderRadius),p=pick(o.linkColor,a.linkColor,r.linkColor,t.options.linkColor,o.link&&o.link.color,a.link&&a.link.color,r.link&&r.link.color,t.options.link&&t.options.link.color),l=pick(o.linkLineWidth,a.linkLineWidth,r.linkLineWidth,t.options.linkLineWidth,o.link&&o.link.lineWidth,a.link&&a.link.lineWidth,r.link&&r.link.lineWidth,t.options.link&&t.options.link.lineWidth),g=pick(o.linkOpacity,a.linkOpacity,r.linkOpacity,t.options.linkOpacity,o.link&&o.link.linkOpacity,a.link&&a.link.linkOpacity,r.link&&r.link.linkOpacity,t.options.link&&t.options.link.linkOpacity);return i.isNode?isNumber(h)&&(s.r=h):(s.stroke=p,s["stroke-width"]=l,s.opacity=g,delete s.fill),s}translateLink(r){var a=this.chart,o=this.options,h=r.fromNode,p=r.toNode,l=pick(o.linkLineWidth,o.link.lineWidth,0),g=pick(o.link.offset,.5),d=pick(r.options.link&&r.options.link.type,o.link.type);if(h.shapeArgs&&p.shapeArgs){var k=o.hangingIndent,c="right"===o.hangingSide,y=p.options.offset,y=/%$/.test(y)&&parseInt(y,10),m=a.inverted;let i=crisp((h.shapeArgs.x||0)+(h.shapeArgs.width||0),l),e=crisp((h.shapeArgs.y||0)+(h.shapeArgs.height||0)/2,l),t=crisp(p.shapeArgs.x||0,l),s=crisp((p.shapeArgs.y||0)+(p.shapeArgs.height||0)/2,l),n;m&&(i-=h.shapeArgs.width||0,t+=p.shapeArgs.width||0),n=this.colDistance?crisp(t+(m?1:-1)*(this.colDistance-this.nodeWidth)/2,l):crisp((t+i)/2,l),y&&(50<=y||y<=-50)&&(n=t=crisp(t+(m?-.5:.5)*(p.shapeArgs.width||0),l),s=p.shapeArgs.y||0,0<y&&(s+=p.shapeArgs.height||0)),p.hangsFrom===h&&(a.inverted?(e=c?crisp((h.shapeArgs.y||0)+k/2,l):crisp((h.shapeArgs.y||0)+(h.shapeArgs.height||0)-k/2,l),s=c?(p.shapeArgs.y||0)+k/2:(p.shapeArgs.y||0)+(p.shapeArgs.height||0)):e=crisp((h.shapeArgs.y||0)+k/2,l),n=t=crisp((p.shapeArgs.x||0)+(p.shapeArgs.width||0)/2,l)),r.plotX=n,r.plotY=(e+s)/2,r.shapeType="path","straight"===d?r.shapeArgs={d:[["M",i,e],["L",t,s]]}:"curved"===d?(y=Math.abs(t-i)*g*(m?-1:1),r.shapeArgs={d:[["M",i,e],["C",i+y,e,t-y,s,t,s]]}):r.shapeArgs={d:PathUtilities.applyRadius([["M",i,e],["L",n,e],["L",n,s],["L",t,s]],pick(o.linkRadius,o.link.radius))},r.dlBox={x:(i+t)/2,y:(e+s)/2,height:l,width:0}}}translateNode(i,e){super.translateNode(i,e);const t=this.chart,s=this.options,n=i.getSum(),r=this.translationFactor,a=Math.max(Math.round(n*r),s.minLinkWidth||0),o="right"===s.hangingSide,h=s.hangingIndent||0,p=s.hangingIndentTranslation,l=s.minNodeLength||10,g=Math.round(this.nodeWidth),d=i.shapeArgs,k=t.inverted?-1:1;let c=i.hangsFrom;if(c)if("cumulative"===p)for(d.height-=h,t.inverted&&!o&&(d.y-=k*h);c;)d.y+=(o?1:k)*h,c=c.hangsFrom;else if("shrink"===p)for(;c&&d.height>h+l;)d.height-=h,t.inverted&&!o||(d.y+=h),c=c.hangsFrom;else d.height-=h,t.inverted&&!o||(d.y+=h);i.nodeHeight=t.inverted?d.width:d.height,i.shapeArgs&&!i.hangsFrom&&(i.shapeArgs=merge(i.shapeArgs,{x:(i.shapeArgs.x||0)+g/2-(i.shapeArgs.width||0)/2,y:(i.shapeArgs.y||0)+a/2-(i.shapeArgs.height||0)/2}))}drawDataLabels(){var i=this.options.dataLabels;if(i.linkTextPath&&i.linkTextPath.enabled)for(const e of this.points)e.options.dataLabels=merge(e.options.dataLabels,{useHTML:!1});super.drawDataLabels()}}OrganizationSeries.defaultOptions=merge(SankeySeries.defaultOptions,OrganizationSeriesDefaults),extend(OrganizationSeries.prototype,{pointClass:OrganizationPoint}),SeriesRegistry.registerSeriesType("organization",OrganizationSeries);export default OrganizationSeries;