"use strict";import ColumnSeries from"./Column/ColumnSeries.js";import H from"../Core/Globals.js";const composed=H["composed"],columnProto=ColumnSeries["prototype"];import Series from"../Core/Series/Series.js";const seriesProto=Series["prototype"];import U from"../Core/Utilities.js";const{defined,pushUnique,stableSort}=U;var OnSeriesComposition;!function(o){function e(o){return seriesProto.getPlotBox.call(this.options.onSeries&&this.chart.get(this.options.onSeries)||this,o)}function s(){columnProto.translate.apply(this);const s=this,o=s.options,t=s.chart,i=s.points,e=o.onSeries,n=e&&t.get(e),r=n&&n.options.step,l=n&&n.points,p=t.inverted,a=s.xAxis,c=s.yAxis;let f=i.length-1,x,u,m=o.onKey||"y",d=l&&l.length,h=0,S,y,C,X,g;if(n&&n.visible&&d)for(h=(n.pointXOffset||0)+(n.barW||0)/2,X=n.currentDataGrouping,y=l[d-1].x+(X?X.totalRange:0),stableSort(i,(o,t)=>o.x-t.x),m="plot"+m[0].toUpperCase()+m.substr(1);d--&&i[f];)if(S=l[d],(x=i[f]).y=S.y,S.x<=x.x&&void 0!==S[m]){if(x.x<=y&&(x.plotY=S[m],S.x<x.x&&!r&&(C=l[d+1])&&void 0!==C[m]))if(defined(x.plotX)&&n.is("spline")){const Y=[S.plotX||0,S.plotY||0],v=[C.plotX||0,C.plotY||0],k=S.controlPoints?.high||Y,O=C.controlPoints?.low||v,U=(o,t)=>Math.pow(1-o,3)*Y[t]+3*(1-o)*(1-o)*o*k[t]+3*(1-o)*o*o*O[t]+o*o*o*v[t];let t=0,e=1,s;for(let o=0;o<100;o++){var b=(t+e)/2,P=U(b,0);if(null===P)break;if(Math.abs(P-x.plotX)<.25){s=b;break}P<x.plotX?t=b:e=b}defined(s)&&(x.plotY=U(s,1),x.y=c.toValue(x.plotY,!0))}else g=(x.x-S.x)/(C.x-S.x),x.plotY+=g*(C[m]-S[m]),x.y+=g*(C.y-S.y);if(f--,d++,f<0)break}i.forEach((o,t)=>{let e;o.plotX+=h,void 0!==o.plotY&&!p||(0<=o.plotX&&o.plotX<=a.len?p?(o.plotY=a.translate(o.x,0,1,0,1),o.plotX=defined(o.y)?c.translate(o.y,0,0,0,1):0):o.plotY=(a.opposite?0:s.yAxis.len)+a.offset:o.shapeArgs={}),(u=i[t-1])&&u.plotX===o.plotX&&(void 0===u.stackIndex&&(u.stackIndex=0),e=u.stackIndex+1),o.stackIndex=e}),this.onSeries=n}o.compose=function(o){if(pushUnique(composed,"OnSeries")){const t=o.prototype;t.getPlotBox=e,t.translate=s}return o},o.getPlotBox=e,o.translate=s}(OnSeriesComposition=OnSeriesComposition||{});export default OnSeriesComposition;