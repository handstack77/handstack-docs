"use strict";import GraphLayout from"../GraphLayoutComposition.js";import PackedBubbleIntegration from"./PackedBubbleIntegration.js";import ReingoldFruchtermanLayout from"../Networkgraph/ReingoldFruchtermanLayout.js";import U from"../../Core/Utilities.js";const{addEvent,pick}=U;function chartGetSelectedParentNodes(){const e=this.series,t=[];return e.forEach(e=>{e.parentNode&&e.parentNode.selected&&t.push(e.parentNode)}),t}function onChartBeforeRedraw(){this.allDataPoints&&delete this.allDataPoints}class PackedBubbleLayout extends ReingoldFruchtermanLayout{constructor(){super(...arguments),this.index=NaN,this.nodes=[],this.series=[]}static compose(e){ReingoldFruchtermanLayout.compose(e),GraphLayout.integrations.packedbubble=PackedBubbleIntegration,GraphLayout.layouts.packedbubble=PackedBubbleLayout;const t=e.prototype;t.getSelectedParentNodes||(addEvent(e,"beforeRedraw",onChartBeforeRedraw),t.getSelectedParentNodes=chartGetSelectedParentNodes)}beforeStep(){this.options.marker&&this.series.forEach(e=>{e&&e.calculateParentRadius()})}isStable(){var e=Math.abs(this.prevSystemTemperature-this.systemTemperature),t=10*this.systemTemperature/Math.sqrt(this.nodes.length);return Math.abs(t)<1&&e<1e-5||this.temperature<=0}setCircularPositions(){var e=this,t=e.box,r=e.nodes,s=r.length+1,o=2*Math.PI/s,a=e.options.initialPositionRadius;let i,n,p=0;for(const d of r)n=e.options.splitSeries&&!d.isParentNode?(i=d.series.parentNode.plotX,d.series.parentNode.plotY):(i=t.width/2,t.height/2),d.plotX=d.prevX=pick(d.plotX,i+a*Math.cos(d.index||p*o)),d.plotY=d.prevY=pick(d.plotY,n+a*Math.sin(d.index||p*o)),d.dispX=0,d.dispY=0,p++}repulsiveForces(){const r=this,s=r.options.bubblePadding,e=r.nodes;let o,a,i;e.forEach(t=>{t.degree=t.mass,t.neighbours=0,e.forEach(e=>{o=0,t===e||t.fixedPosition||!r.options.seriesInteraction&&t.series!==e.series||(i=r.getDistXY(t,e),(a=r.vectorLength(i)-(t.marker.radius+e.marker.radius+s))<0&&(t.degree+=.01,t.neighbours++,o=r.repulsiveForce(-a/Math.sqrt(t.neighbours),r.k,t,e)),r.force("repulsive",t,o*e.mass,i,e,a))})})}applyLimitBox(e,t){var r,s=this;s.options.splitSeries&&!e.isParentNode&&s.options.parentNodeLimit&&(r=s.getDistXY(e,e.series.parentNode),(s=e.series.parentNodeRadius-e.marker.radius-s.vectorLength(r))<0&&s>-2*e.marker.radius&&(e.plotX-=.01*r.x,e.plotY-=.01*r.y)),super.applyLimitBox(e,t)}}export default GraphLayout.layouts.packedbubble=PackedBubbleLayout;