"use strict";import Point from"../../Core/Series/Point.js";import SeriesRegistry from"../../Core/Series/SeriesRegistry.js";const{treemap:{prototype:{pointClass:TreemapPoint}}}=SeriesRegistry["seriesTypes"];import U from"../../Core/Utilities.js";const{addEvent,fireEvent,merge}=U;class TreegraphPoint extends TreemapPoint{constructor(){super(...arguments),this.dataLabelOnHidden=!0,this.isLink=!1,this.setState=Point.prototype.setState}draw(){super.draw.apply(this,arguments);const t=this.graphic;t&&t.animate({visibility:this.visible?"inherit":"hidden"}),this.renderCollapseButton()}renderCollapseButton(){const t=this,e=t.series,i=t.graphic&&t.graphic.parentGroup,o=e.mapOptionsToLevel[t.node.level||0]||{},s=merge(e.options.collapseButton,o.collapseButton,t.options.collapseButton),{width:n,height:r,shape:l,style:a}=s,p=this.series.chart,h=!t.visible||!t.collapsed&&s.onlyOnHover&&"hover"!==t.state?0:1;var d,c,g;t.shapeArgs&&(this.collapseButtonOptions=s,t.collapseButton?t.node.children.length&&s.enabled?({x:d,y:c}=this.getCollapseBtnPosition(s),t.collapseButton.attr({text:t.collapsed?"+":"-",rotation:p.inverted?90:0,rotationOriginX:n/2,rotationOriginY:r/2,visibility:t.visible?"inherit":"hidden"}).animate({x:d,y:c,opacity:h})):(t.collapseButton.destroy(),delete t.collapseButton):t.node.children.length&&s.enabled&&({x:d,y:c}=this.getCollapseBtnPosition(s),g=s.fillColor||t.color||"#cccccc",t.collapseButton=p.renderer.label(t.collapsed?"+":"-",d,c,l).attr({height:r-4,width:n-4,padding:2,fill:g,rotation:p.inverted?90:0,rotationOriginX:n/2,rotationOriginY:r/2,stroke:s.lineColor||"#ffffff","stroke-width":s.lineWidth,"text-align":"center",align:"center",zIndex:1,opacity:h,visibility:t.visible?"inherit":"hidden"}).addClass("highcharts-tracker").addClass("highcharts-collapse-button").removeClass("highcharts-no-tooltip").css(merge({color:"string"==typeof g?p.renderer.getContrast(g):"#333333"},a)).add(i),t.collapseButton.element.point=t))}toggleCollapse(t){const e=this.series;this.update({collapsed:t??!this.collapsed},!1,void 0,!1),fireEvent(e,"toggleCollapse"),e.redraw()}destroy(){this.collapseButton&&(this.collapseButton.destroy(),delete this.collapseButton,this.collapseButton=void 0),this.linkToParent&&(this.linkToParent.destroy(),delete this.linkToParent),super.destroy.apply(this,arguments)}getCollapseBtnPosition(t){var e=this.series.chart.inverted,i=t.width,o=t.height,{x:s=0,y:n=0,width:r=0,height:l=0}=this.shapeArgs||{};return{x:s+t.x+(e?.3*-o:r+-.3*i),y:n+l/2-o/2+t.y}}}addEvent(TreegraphPoint,"mouseOut",function(){const t=this.collapseButton,e=this.collapseButtonOptions;t&&e?.onlyOnHover&&!this.collapsed&&t.animate({opacity:0})}),addEvent(TreegraphPoint,"mouseOver",function(){this.collapseButton&&this.visible&&this.collapseButton.animate({opacity:1},this.series.options.states?.hover?.animation)}),addEvent(TreegraphPoint,"click",function(){this.toggleCollapse()});export default TreegraphPoint;