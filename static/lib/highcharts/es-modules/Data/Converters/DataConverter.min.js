"use strict";import DataTable from"../DataTable.js";import U from"../../Core/Utilities.js";const{addEvent,fireEvent,isNumber,merge}=U;class DataConverter{constructor(e){this.dateFormats={"YYYY/mm/dd":{regex:/^(\d{4})([\-\.\/])(\d{1,2})\2(\d{1,2})$/,parser:function(e){return e?Date.UTC(+e[1],e[3]-1,+e[4]):NaN}},"dd/mm/YYYY":{regex:/^(\d{1,2})([\-\.\/])(\d{1,2})\2(\d{4})$/,parser:function(e){return e?Date.UTC(+e[4],e[3]-1,+e[1]):NaN},alternative:"mm/dd/YYYY"},"mm/dd/YYYY":{regex:/^(\d{1,2})([\-\.\/])(\d{1,2})\2(\d{4})$/,parser:function(e){return e?Date.UTC(+e[4],e[1]-1,+e[3]):NaN}},"dd/mm/YY":{regex:/^(\d{1,2})([\-\.\/])(\d{1,2})\2(\d{2})$/,parser:function(e){const t=new Date;if(!e)return NaN;let r=+e[4];return r>t.getFullYear()-2e3?r+=1900:r+=2e3,Date.UTC(r,e[3]-1,+e[1])},alternative:"mm/dd/YY"},"mm/dd/YY":{regex:/^(\d{1,2})([\-\.\/])(\d{1,2})\2(\d{2})$/,parser:function(e){return e?Date.UTC(+e[4]+2e3,e[1]-1,+e[3]):NaN}}};e=merge(DataConverter.defaultOptions,e);let t=e.decimalPoint;"."!==t&&","!==t||(t="."===t?"\\.":",",this.decimalRegExp=new RegExp("^(-?[0-9]+)"+t+"([0-9]+)$")),this.options=e}asBoolean(e){return"boolean"==typeof e?e:"string"==typeof e?""!==e&&"0"!==e&&"false"!==e:!!this.asNumber(e)}asDate(e){let t;if("string"==typeof e)t=this.parseDate(e);else if("number"==typeof e)t=e;else{if(e instanceof Date)return e;t=this.parseDate(this.asString(e))}return new Date(t)}asGuessedType(e){const t=this,r={number:t.asNumber,Date:t.asDate,string:t.asString};return r[t.guessType(e)].call(t,e)}asNumber(e){if("number"==typeof e)return e;if("boolean"==typeof e)return e?1:0;if("string"!=typeof e)return e instanceof Date?e.getDate():e?e.getRowCount():NaN;{const t=this.decimalRegExp;if(-1<e.indexOf(" ")&&(e=e.replace(/\s+/g,"")),t){if(!t.test(e))return NaN;e=e.replace(t,"$1.$2")}return parseFloat(e)}}asString(e){return""+e}deduceDateFormat(e,t,r){const a=[],n=[];let s="YYYY/mm/dd",o,i=[],m=0,d=!1,l,u;for((!t||t>e.length)&&(t=e.length);m<t;m++)if(void 0!==e[m]&&e[m]&&e[m].length)for(o=e[m].trim().replace(/[\-\.\/]/g," ").split(" "),i=["","",""],u=0;u<o.length;u++)u<i.length&&(l=parseInt(o[u],10))&&(n[u]=!n[u]||n[u]<l?l:n[u],void 0!==a[u]?a[u]!==l&&(a[u]=!1):a[u]=l,31<l?i[u]=l<100?"YY":"YYYY":12<l&&l<=31?(i[u]="dd",d=!0):i[u].length||(i[u]="mm"));if(d){for(u=0;u<a.length;u++)!1!==a[u]?12<n[u]&&"YY"!==i[u]&&"YYYY"!==i[u]&&(i[u]="YY"):12<n[u]&&"mm"===i[u]&&(i[u]="dd");3===i.length&&"dd"===i[1]&&"dd"===i[2]&&(i[2]="YY"),s=i.join("/")}return r&&(this.options.dateFormat=s),s}emit(e){fireEvent(this,e.type,e)}export(e,t){throw this.emit({type:"exportError",columns:[],headers:[]}),new Error("Not implemented")}getTable(){throw new Error("Not implemented")}guessType(t){var r=this;let a="string";if("string"==typeof t){const s=r.trim(""+t),o=r.decimalRegExp;let e=r.trim(s,!0);o&&(e=o.test(e)?e.replace(o,"$1.$2"):"");var n=parseFloat(e);+e===n?t=n:(n=r.parseDate(t),a=isNumber(n)?"Date":"string")}return a="number"==typeof t?31536e6<t?"Date":"number":a}on(e,t){return addEvent(this,e,t)}parse(e){throw this.emit({type:"parseError",columns:[],headers:[]}),new Error("Not implemented")}parseDate(e,t){const r=this,a=r.options;let n=t||a.dateFormat,s=NaN,o,i,m;if(a.parseDate)s=a.parseDate(e);else{if(n)i=(i=r.dateFormats[n])||r.dateFormats["YYYY/mm/dd"],(m=e.match(i.regex))&&(s=i.parser(m));else for(o in r.dateFormats)if(i=r.dateFormats[o],m=e.match(i.regex)){n=o,s=i.parser(m);break}m||("object"==typeof(m=Date.parse(e))&&null!==m&&m.getTime?s=m.getTime()-6e4*m.getTimezoneOffset():isNumber(m)&&(s=m-6e4*new Date(m).getTimezoneOffset(),-1===e.indexOf("2001")&&2001===new Date(s).getFullYear()&&(s=NaN)))}return s}trim(e,t){return"string"==typeof e&&(e=e.replace(/^\s+|\s+$/g,""),t&&/^[\d\s]+$/.test(e)&&(e=e.replace(/\s/g,""))),e}}DataConverter.defaultOptions={dateFormat:"",alternativeFormat:"",startColumn:0,endColumn:Number.MAX_VALUE,startRow:0,endRow:Number.MAX_VALUE,firstRowAsNames:!0,switchRowsAndColumns:!1},(DataConverter||(DataConverter={})).getTableFromColumns=function(r=[],a=[]){const n=new DataTable;for(let e=0,t=Math.max(a.length,r.length);e<t;++e)n.setColumn(a[e]||""+e,r[e]);return n};export default DataConverter;