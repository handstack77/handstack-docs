"use strict";import DataModifier from"./DataModifier.js";import DataTable from"../DataTable.js";import U from"../../Core/Utilities.js";const merge=U["merge"];class SortModifier extends DataModifier{static ascending(e,o){return(e||0)<(o||0)?-1:(o||0)<(e||0)?1:0}static descending(e,o){return(o||0)<(e||0)?-1:(e||0)<(o||0)?1:0}constructor(e){super(),this.options=merge(SortModifier.defaultOptions,e)}getRowReferences(e){const t=e.getRows(),i=[];for(let e=0,o=t.length;e<o;++e)i.push({index:e,row:t[e]});return i}modifyCell(e,o,t,i,r){var n=this,{orderByColumn:d,orderInColumn:s}=n.options;return o===d&&(s?(e.modified.setCell(o,t,i),e.modified.setColumn(s,n.modifyTable(new DataTable({columns:e.getColumns([d,s])})).modified.getColumn(s))):n.modifyTable(e,r)),e}modifyColumns(e,o,t,i){const r=this,{orderByColumn:n,orderInColumn:d}=r.options,s=Object.keys(o);return-1<s.indexOf(n)&&(d&&o[s[0]].length?(e.modified.setColumns(o,t),e.modified.setColumn(d,r.modifyTable(new DataTable({columns:e.getColumns([n,d])})).modified.getColumn(d))):r.modifyTable(e,i)),e}modifyRows(e,o,t,i){var r=this,{orderByColumn:n,orderInColumn:d}=r.options;return d&&o.length?(e.modified.setRows(o,t),e.modified.setColumn(d,r.modifyTable(new DataTable({columns:e.getColumns([n,d])})).modified.getColumn(d))):r.modifyTable(e,i),e}modifyTable(e,o){var t,i=this;i.emit({type:"modify",detail:o,table:e});const r=e.getColumnNames(),n=e.getRowCount(),d=this.getRowReferences(e),{direction:s,orderByColumn:l,orderInColumn:m}=i.options,a="asc"===s?SortModifier.ascending:SortModifier.descending,f=r.indexOf(l),u=e.modified;if(-1!==f&&d.sort((e,o)=>a(e.row[f],o.row[f])),m){const c=[];for(let e=0;e<n;++e)c[d[e].index]=e;u.setColumns({[m]:c})}else{const C=[],g=[];for(let e=0;e<n;++e)t=d[e],C.push(u.getOriginalRowIndex(t.index)),g.push(t.row);u.setRows(g,0),u.setOriginalRowIndexes(C)}return i.emit({type:"afterModify",detail:o,table:e}),e}}SortModifier.defaultOptions={type:"Sort",direction:"desc",orderByColumn:"y"},DataModifier.registerType("Sort",SortModifier);export default SortModifier;