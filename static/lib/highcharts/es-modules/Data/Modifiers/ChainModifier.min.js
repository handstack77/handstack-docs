"use strict";import DataModifier from"./DataModifier.js";import U from"../../Core/Utilities.js";const merge=U["merge"];class ChainModifier extends DataModifier{constructor(e,...r){super(),this.chain=r,this.options=merge(ChainModifier.defaultOptions,e);var d=this.options.chain||[];for(let e=0,i=d.length,t,o;e<i;++e)(t=d[e]).type&&(o=DataModifier.types[t.type])&&r.push(new o(t))}add(e,i){this.emit({type:"addModifier",detail:i,modifier:e}),this.chain.push(e),this.emit({type:"addModifier",detail:i,modifier:e})}clear(e){this.emit({type:"clearChain",detail:e}),this.chain.length=0,this.emit({type:"afterClearChain",detail:e})}async modify(t,o){const r=this.options.reverse?this.chain.slice().reverse():this.chain.slice();t.modified===t&&(t.modified=t.clone(!1,o));let d=t;for(let e=0,i=r.length;e<i;++e){try{await r[e].modify(d,o)}catch(e){throw this.emit({type:"error",detail:o,table:t}),e}d=d.modified}return t.modified=d,t}modifyCell(e,o,r,d,s){const a=this.options.reverse?this.chain.reverse():this.chain;if(a.length){let t=e.clone();for(let e=0,i=a.length;e<i;++e)a[e].modifyCell(t,o,r,d,s),t=t.modified;e.modified=t}return e}modifyColumns(e,o,r,d){const s=this.options.reverse?this.chain.reverse():this.chain.slice();if(s.length){let t=e.clone();for(let e=0,i=s.length;e<i;++e)s[e].modifyColumns(t,o,r,d),t=t.modified;e.modified=t}return e}modifyRows(e,o,r,d){const s=this.options.reverse?this.chain.reverse():this.chain.slice();if(s.length){let t=e.clone();for(let e=0,i=s.length;e<i;++e)s[e].modifyRows(t,o,r,d),t=t.modified;e.modified=t}return e}modifyTable(e,o){var i=this,r=(i.emit({type:"modify",detail:o,table:e}),i.options.reverse?i.chain.reverse():i.chain.slice());let d=e.modified;for(let e=0,i=r.length,t;e<i;++e)t=r[e],d=t.modifyTable(d,o).modified;return e.modified=d,i.emit({type:"afterModify",detail:o,table:e}),e}remove(e,i){const t=this.chain;this.emit({type:"removeModifier",detail:i,modifier:e}),t.splice(t.indexOf(e),1),this.emit({type:"afterRemoveModifier",detail:i,modifier:e})}}ChainModifier.defaultOptions={type:"Chain"},DataModifier.registerType("Chain",ChainModifier);export default ChainModifier;