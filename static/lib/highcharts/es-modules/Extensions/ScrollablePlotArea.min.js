"use strict";import A from"../Core/Animation/AnimationUtilities.js";const stop=A["stop"];import H from"../Core/Globals.js";const composed=H["composed"];import RendererRegistry from"../Core/Renderer/RendererRegistry.js";import U from"../Core/Utilities.js";const{addEvent,createElement,css,defined,merge,pushUnique}=U;function onChartRender(){let e=this.scrollablePlotArea;!this.scrollablePixelsX&&!this.scrollablePixelsY||e||(this.scrollablePlotArea=e=new ScrollablePlotArea(this)),e?.applyFixed()}function markDirty(){this.chart.scrollablePlotArea&&(this.chart.scrollablePlotArea.isDirty=!0)}class ScrollablePlotArea{static compose(e,t,r){pushUnique(composed,this.compose)&&(addEvent(e,"afterInit",markDirty),addEvent(t,"afterSetChartSize",e=>this.afterSetSize(e.target,e)),addEvent(t,"render",onChartRender),addEvent(r,"show",markDirty))}static afterSetSize(e,t){const{minWidth:r,minHeight:i}=e.options.chart.scrollablePlotArea||{},{clipBox:o,plotBox:s,inverted:l,renderer:a}=e;let h,n,c;if(!a.forExport&&(r?(e.scrollablePixelsX=h=Math.max(0,r-e.chartWidth),h&&(e.scrollablePlotBox=merge(e.plotBox),s.width=e.plotWidth+=h,o[l?"height":"width"]+=h,c=!0)):i&&(e.scrollablePixelsY=n=Math.max(0,i-e.chartHeight),defined(n)&&(e.scrollablePlotBox=merge(e.plotBox),s.height=e.plotHeight+=n,o[l?"width":"height"]+=n,c=!1)),defined(c)&&!t.skipAxes))for(const d of e.axes)d.horiz===c&&(d.setAxisSize(),d.setAxisTranslation())}constructor(r){const e=r.options.chart,t=RendererRegistry.getRendererType(),i=e.scrollablePlotArea||{},o=this.moveFixedElements.bind(this),s={WebkitOverflowScrolling:"touch",overflowX:"hidden",overflowY:"hidden"},l=(r.scrollablePixelsX&&(s.overflowX="auto"),r.scrollablePixelsY&&(s.overflowY="auto"),this.chart=r,this.parentDiv=createElement("div",{className:"highcharts-scrolling-parent"},{position:"relative"},r.renderTo)),a=this.scrollingContainer=createElement("div",{className:"highcharts-scrolling"},s,l),h=this.innerContainer=createElement("div",{className:"highcharts-inner-container"},void 0,a),n=this.fixedDiv=createElement("div",{className:"highcharts-fixed"},{position:"absolute",overflow:"hidden",pointerEvents:"none",zIndex:(e.style?.zIndex||0)+2,top:0},void 0,!0),c=this.fixedRenderer=new t(n,r.chartWidth,r.chartHeight,e.style);this.mask=c.path().attr({fill:e.backgroundColor||"#fff","fill-opacity":i.opacity??.85,zIndex:-1}).addClass("highcharts-scrollable-mask").add(),a.parentNode.insertBefore(n,a),css(r.renderTo,{overflow:"visible"}),addEvent(r,"afterShowResetZoom",o),addEvent(r,"afterApplyDrilldown",o),addEvent(r,"afterLayOutTitles",o);let d;addEvent(a,"scroll",()=>{const{pointer:e,hoverPoint:t}=r;e&&(delete e.chartPosition,t&&(d=t),e.runPointActions(void 0,d,!0))}),h.appendChild(r.container)}applyFixed(){const{chart:e,fixedRenderer:t,isDirty:r,scrollingContainer:i}=this,{axisOffset:o,chartWidth:s,chartHeight:l,container:a,plotHeight:h,plotLeft:n,plotTop:c,plotWidth:d,scrollablePixelsX:p=0,scrollablePixelsY:g=0}=e,x=e.options.chart,f=x.scrollablePlotArea||{},{scrollPositionX:m=0,scrollPositionY:b=0}=f,v=s+p,P=l+g;t.setSize(s,l),(r??!0)&&(this.isDirty=!1,this.moveFixedElements()),stop(e.container),css(a,{width:v+"px",height:P+"px"}),e.renderer.boxWrapper.attr({width:v,height:P,viewBox:[0,0,v,P].join(" ")}),e.chartBackground?.attr({width:v,height:P}),css(i,{width:s+"px",height:l+"px"}),defined(r)||(i.scrollLeft=p*m,i.scrollTop=g*b);var u=c-o[0]-1,y=n-o[3]-1,A=c+h+o[2]+1,w=n+d+o[1]+1,E=n+d-p,S=c+h-g;let L=[["M",0,0]];p?L=[["M",0,u],["L",n-1,u],["L",n-1,A],["L",0,A],["Z"],["M",E,u],["L",s,u],["L",s,A],["L",E,A],["Z"]]:g&&(L=[["M",y,0],["L",y,c-1],["L",w,c-1],["L",w,0],["Z"],["M",y,S],["L",y,l],["L",w,l],["L",w,S],["Z"]]),"adjustHeight"!==e.redrawTrigger&&this.mask.attr({d:L})}moveFixedElements(){const{container:e,inverted:t,scrollablePixelsX:r,scrollablePixelsY:i}=this.chart,o=this.fixedRenderer,s=ScrollablePlotArea.fixedSelectors;let l;r&&!t?l=".highcharts-yaxis":r&&t||i&&!t?l=".highcharts-xaxis":i&&t&&(l=".highcharts-yaxis"),l&&s.push(l+":not(.highcharts-radial-axis)",l+"-labels:not(.highcharts-radial-axis-labels)");for(const a of s)[].forEach.call(e.querySelectorAll(a),e=>{(e.namespaceURI===o.SVG_NS?o.box:o.box.parentNode).appendChild(e),e.style.pointerEvents="auto"})}}ScrollablePlotArea.fixedSelectors=[".highcharts-breadcrumbs-group",".highcharts-contextbutton",".highcharts-caption",".highcharts-credits",".highcharts-drillup-button",".highcharts-legend",".highcharts-legend-checkbox",".highcharts-navigator-series",".highcharts-navigator-xaxis",".highcharts-navigator-yaxis",".highcharts-navigator",".highcharts-range-selector-group",".highcharts-reset-zoom",".highcharts-scrollbar",".highcharts-subtitle",".highcharts-title"];export default ScrollablePlotArea;