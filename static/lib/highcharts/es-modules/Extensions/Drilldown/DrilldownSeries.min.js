"use strict";import A from"../../Core/Animation/AnimationUtilities.js";const animObject=A["animObject"];import U from"../../Core/Utilities.js";const{addEvent,extend,fireEvent,merge,pick,syncTimeout}=U;function applyCursorCSS(o,i,n,t){o[n?"addClass":"removeClass"]("highcharts-drilldown-point"),t||o.css({cursor:i})}function columnAnimateDrilldown(o){const t=this,i=t.chart,r=i.drilldownLevels,e=animObject((i.options.drilldown||{}).animation),l=this.xAxis,a=i.styledMode;if(!o){let n;(r||[]).forEach(o=>{t.options._ddSeriesId===o.lowerSeriesOptions._ddSeriesId&&(n=o.shapeArgs,!a&&n&&(n.fill=o.color))}),n.x+=pick(l.oldPos,l.pos)-l.pos,t.points.forEach(o=>{const i=o.shapeArgs;a||(i.fill=o.color),o.graphic&&o.graphic.attr(n).animate(extend(o.shapeArgs,{fill:o.color||t.color}),e)}),i.drilldown&&i.drilldown.fadeInGroup(this.dataLabelsGroup),delete this.animate}}function columnAnimateDrillupFrom(r){const e=this,l=animObject((e.chart.options.drilldown||{}).animation);(e.trackerGroups||[]).forEach(o=>{e[o]&&e[o].on("mouseover")});let a=e.group;const s=a!==e.chart.columnGroup;s&&delete e.group,this.points.forEach(o=>{const i=o.graphic,n=r.shapeArgs;var t;i&&n&&(t=()=>{i.destroy(),a&&s&&(a=a.destroy())},delete o.graphic,e.chart.styledMode||(n.fill=r.color),l.duration?i.animate(n,merge(l,{complete:t})):(i.attr(n),t()))})}function columnAnimateDrillupTo(o){const n=this,e=n.drilldownLevel;o||(n.points.forEach(o=>{const i=o.dataLabel;o.graphic&&o.graphic.hide(),i&&(i.hidden="hidden"===i.attr("visibility"),i.hidden||(i.hide(),i.connector?.hide()))}),syncTimeout(()=>{if(n.points){let i=[];n.data.forEach(o=>{i.push(o)}),(i=n.nodes?i.concat(n.nodes):i).forEach((o,i)=>{const n=i===(e&&e.pointIndex)?"show":"fadeIn",t="show"==n||void 0,r=o.dataLabel;o.graphic&&o.visible&&o.graphic[n](t),r&&!r.hidden&&(r.fadeIn(),r.connector?.fadeIn())})}},Math.max(n.chart.options.drilldown.animation.duration-50,0)),delete this.animate)}function compose(o,i){const n=o.prototype.pointClass,t=n.prototype;if(!t.doDrilldown){var{column:i,map:r,pie:e}=i;if(addEvent(n,"afterInit",onPointAfterInit),addEvent(n,"afterSetState",onPointAfterSetState),addEvent(n,"update",onPointUpdate),t.doDrilldown=pointDoDrilldown,t.runDrilldown=pointRunDrilldown,addEvent(o,"afterDrawDataLabels",onSeriesAfterDrawDataLabels),addEvent(o,"afterDrawTracker",onSeriesAfterDrawTracker),i){const l=i.prototype;l.animateDrilldown=columnAnimateDrilldown,l.animateDrillupFrom=columnAnimateDrillupFrom,l.animateDrillupTo=columnAnimateDrillupTo}if(r){const a=r.prototype;a.animateDrilldown=mapAnimateDrilldown,a.animateDrillupFrom=mapAnimateDrillupFrom,a.animateDrillupTo=mapAnimateDrillupTo}if(e){const s=e.prototype;s.animateDrilldown=pieAnimateDrilldown,s.animateDrillupFrom=columnAnimateDrillupFrom,s.animateDrillupTo=columnAnimateDrillupTo}}}function mapAnimateDrilldown(o){const i=this,n=i.chart,t=i.group;n&&t&&i.options&&n.options.drilldown&&n.options.drilldown.animation&&(o&&n.mapView?(t.attr({opacity:.01}),n.mapView.allowTransformAnimation=!1,i.options.inactiveOtherPoints=!0,i.options.enableMouseTracking=!1):(t.animate({opacity:1},n.options.drilldown.animation,()=>{i.options&&(i.options.inactiveOtherPoints=!1,i.options.enableMouseTracking=pick(i.userOptions&&i.userOptions.enableMouseTracking,!0),i.isDirty=!0,n.redraw())}),n.drilldown&&n.drilldown.fadeInGroup(this.dataLabelsGroup)))}function mapAnimateDrillupFrom(){const o=this,i=o.chart;i&&i.mapView&&(i.mapView.allowTransformAnimation=!1),o.options&&(o.options.inactiveOtherPoints=!0)}function mapAnimateDrillupTo(o){const i=this,n=i.chart,t=i.group;n&&t&&(o?(t.attr({opacity:.01}),i.options&&(i.options.inactiveOtherPoints=!0)):(t.animate({opacity:1},(n.options.drilldown||{}).animation),n.drilldown&&n.drilldown.fadeInGroup(i.dataLabelsGroup)))}function onPointAfterInit(){var o=this;return o.drilldown&&!o.unbindDrilldownClick&&(o.unbindDrilldownClick=addEvent(o,"click",onPointClick)),o}function onPointAfterSetState(){var o=this.series,i=o.chart.styledMode;this.drilldown&&o.halo&&"hover"===this.state?applyCursorCSS(o.halo,"pointer",!0,i):o.halo&&applyCursorCSS(o.halo,"auto",!1,i)}function onPointClick(o){const i=this.series;i.xAxis&&!1===(i.chart.options.drilldown||{}).allowPointDrilldown?i.xAxis.drilldownCategory(this.x,o):this.runDrilldown(void 0,void 0,o)}function onPointUpdate(o){var i=this,o=o.options||{};o.drilldown&&!i.unbindDrilldownClick?i.unbindDrilldownClick=addEvent(i,"click",onPointClick):!o.drilldown&&void 0!==o.drilldown&&i.unbindDrilldownClick&&(i.unbindDrilldownClick=i.unbindDrilldownClick())}function onSeriesAfterDrawDataLabels(){const o=this.chart,i=o.options.drilldown.activeDataLabelStyle,n=o.renderer,t=o.styledMode;for(const r of this.points){const e=r.options.dataLabels,l=pick(r.dlOptions,e&&e.style,{});r.drilldown&&r.dataLabel&&("contrast"!==i.color||t||(l.color=n.getContrast(r.color||this.color)),e&&e.color&&(l.color=e.color),r.dataLabel.addClass("highcharts-drilldown-data-label"),t||r.dataLabel.css(i).css(l))}}function onSeriesAfterDrawTracker(){var o=this.chart.styledMode;for(const i of this.points)i.drilldown&&i.graphic&&applyCursorCSS(i.graphic,"pointer",!0,o)}function pieAnimateDrilldown(o){const i=this,r=i.chart,e=i.points,l=r.drilldownLevels[r.drilldownLevels.length-1],a=r.options.drilldown.animation;if(i.is("item")&&(a.duration=0),i.center){const s=l.shapeArgs,d=s.start,n=s.end-d,c=n/i.points.length,p=r.styledMode;if(!o){let n,t;for(let o=0,i=e.length;o<i;++o)t=e[o],n=t.shapeArgs,p||(s.fill=l.color,n.fill=t.color),t.graphic&&t.graphic.attr(merge(s,{start:d+o*c,end:d+(o+1)*c}))[a?"animate":"attr"](n,a);r.drilldown&&r.drilldown.fadeInGroup(i.dataLabelsGroup),delete i.animate}}}function pointDoDrilldown(){this.runDrilldown()}function pointRunDrilldown(t,o,i){const n=this,r=n.series,e=r.chart,l=e.options.drilldown||{};let a=(l.series||[]).length,s;for(e.ddDupes||(e.ddDupes=[]),e.colorCounter=e.symbolCounter=0;a--&&!s;)l.series&&l.series[a].id===n.drilldown&&n.drilldown&&-1===e.ddDupes.indexOf(n.drilldown)&&(s=l.series[a],e.ddDupes.push(n.drilldown));fireEvent(e,"drilldown",{point:n,seriesOptions:s,category:o,originalEvent:i,points:void 0!==o&&r.xAxis.getDDPoints(o).slice(0)},o=>{const i=o.point.series&&o.point.series.chart,n=o.seriesOptions;i&&n&&(t?i.addSingleSeriesAsDrilldown(o.point,n):i.addSeriesAsDrilldown(o.point,n))})}const DrilldownSeries={compose:compose};export default DrilldownSeries;