"use strict";import H from"../../Core/Globals.js";const{doc,isTouchDevice}=H;import U from"../../Core/Utilities.js";const{addEvent,fireEvent,objectEach,pick,removeEvent}=U;class EventEmitter{addEvents(){function t(e){addEvent(e,isTouchDevice?"touchstart":"mousedown",e=>{r.onMouseDown(e)},{passive:!1})}const r=this;if(t(this.graphic.element),(r.labels||[]).forEach(e=>{e.options.useHTML&&e.graphic.text&&t(e.graphic.text.element)}),objectEach(r.options.events,(t,a)=>{function e(e){"click"===a&&r.cancelClick||t.call(r,r.chart.pointer?.normalize(e),r.target)}-1===(r.nonDOMEvents||[]).indexOf(a)?(addEvent(r.graphic.element,a,e,{passive:!1}),r.graphic.div&&addEvent(r.graphic.div,a,e,{passive:!1})):addEvent(r,a,e,{passive:!1})}),r.options.draggable&&(addEvent(r,"drag",r.onDrag),!r.graphic.renderer.styledMode)){const a={cursor:{x:"ew-resize",y:"ns-resize",xy:"move"}[r.options.draggable]};r.graphic.css(a),(r.labels||[]).forEach(e=>{e.options.useHTML&&e.graphic.text&&e.graphic.text.css(a)})}r.isUpdating||fireEvent(r,"add")}destroy(){this.removeDocEvents(),removeEvent(this),this.hcEvents=null}mouseMoveToRadians(e,t,a){let r=e.prevChartY-a,o=e.prevChartX-t,s=e.chartY-a,i=e.chartX-t,n;return this.chart.inverted&&(n=o,o=r,r=n,n=i,i=s,s=n),Math.atan2(s,i)-Math.atan2(r,o)}mouseMoveToScale(e,t,a){var r=e.prevChartX-t,o=e.prevChartY-a;let s=(e.chartX-t||1)/(r||1),i=(e.chartY-a||1)/(o||1);return this.chart.inverted&&(t=i,i=s,s=t),{x:s,y:i}}mouseMoveToTranslation(e){let t=e.chartX-e.prevChartX,a=e.chartY-e.prevChartY,r;return this.chart.inverted&&(r=a,a=t,t=r),{x:t,y:a}}onDrag(e){if(this.chart.isInsidePlot(e.chartX-this.chart.plotLeft,e.chartY-this.chart.plotTop,{visiblePlotOnly:!0})){const t=this.mouseMoveToTranslation(e);"x"===this.options.draggable&&(t.y=0),"y"===this.options.draggable&&(t.x=0);e=this;e.points.length?e.translate(t.x,t.y):(e.shapes.forEach(e=>e.translate(t.x,t.y)),e.labels.forEach(e=>e.translate(t.x,t.y))),this.redraw(!1)}}onMouseDown(e){if(e.preventDefault&&e.preventDefault(),2!==e.button){const r=this,o=r.chart.pointer,s=e?.sourceCapabilities?.firesTouchEvents||!1;let t=(e=o?.normalize(e)||e).chartX,a=e.chartY;r.cancelClick=!1,r.chart.hasDraggedAnnotation=!0,r.removeDrag=addEvent(doc,isTouchDevice||s?"touchmove":"mousemove",function(e){r.hasDragged=!0,(e=o?.normalize(e)||e).prevChartX=t,e.prevChartY=a,fireEvent(r,"drag",e),t=e.chartX,a=e.chartY},isTouchDevice||s?{passive:!1}:void 0),r.removeMouseUp=addEvent(doc,isTouchDevice||s?"touchend":"mouseup",function(){const e=pick(r.target&&r.target.annotation,r.target);e&&(e.cancelClick=r.hasDragged),r.cancelClick=r.hasDragged,r.chart.hasDraggedAnnotation=!1,r.hasDragged&&fireEvent(pick(e,r),"afterUpdate"),r.hasDragged=!1,r.onMouseUp()},isTouchDevice||s?{passive:!1}:void 0)}}onMouseUp(){this.removeDocEvents()}removeDocEvents(){this.removeDrag&&(this.removeDrag=this.removeDrag()),this.removeMouseUp&&(this.removeMouseUp=this.removeMouseUp())}}export default EventEmitter;