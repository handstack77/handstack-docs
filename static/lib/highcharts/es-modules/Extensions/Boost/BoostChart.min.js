"use strict";import BoostableMap from"./BoostableMap.js";import H from"../../Core/Globals.js";const composed=H["composed"];import U from"../../Core/Utilities.js";const{addEvent,pick,pushUnique}=U;function compose(o,t){return t&&pushUnique(composed,"Boost.Chart")&&o.prototype.callbacks.push(onChartCallback),o}function getBoostClipRect(o,t){var e,s,i=o.navigator;let r={x:o.plotLeft,y:o.plotTop,width:o.plotWidth,height:o.plotHeight};return i&&o.inverted?(r.width+=i.top+i.height,i.opposite||(r.x=i.left)):i&&!o.inverted&&(r.height=i.top+i.height-o.plotTop),t.getClipBox&&({xAxis:i,yAxis:e}=t,r=t.getClipBox(),o.inverted?(s=r.width,r.width=r.height,r.height=s,r.x=e.pos,r.y=i.pos):(r.x=i.pos,r.y=e.pos)),t===o&&(s=o.inverted?o.xAxis:o.yAxis).length<=1&&(r.y=Math.min(s[0].pos,r.y),r.height=s[0].pos-o.plotTop+s[0].len),r}function isChartSeriesBoosting(o){const t=o.series,e=o.boost=o.boost||{},s=o.options.boost||{},i=pick(s.seriesThreshold,50);if(t.length>=i)return!0;if(1===t.length)return!1;let r=s.allowForce;if(void 0===r){r=!0;for(const h of o.xAxis)if(pick(h.min,-1/0)>pick(h.dataMin,-1/0)||pick(h.max,1/0)<pick(h.dataMax,1/0)){r=!1;break}}if(void 0!==e.forceChartBoost){if(r)return e.forceChartBoost;e.forceChartBoost=void 0}let a=0,n=0,p;for(const l of t)0!==(p=l.options).boostThreshold&&!1!==l.visible&&"heatmap"!==l.type&&(BoostableMap[l.type]&&++a,patientMax(l.processedXData,p.data,l.points)>=(p.boostThreshold||Number.MAX_VALUE)&&++n);return e.forceChartBoost=r&&(a===t.length&&n===a||5<n),e.forceChartBoost}function onChartCallback(e){function o(){e.boost&&e.boost.wgl&&isChartSeriesBoosting(e)&&e.boost.wgl.render(e)}addEvent(e,"predraw",function(){e.boost=e.boost||{},e.boost.forceChartBoost=void 0,e.boosted=!1,e.axes.some(o=>o.isPanning)||e.boost.clear?.(),e.boost.canvas&&e.boost.wgl&&isChartSeriesBoosting(e)&&e.boost.wgl.allocateBuffer(e),e.boost.markerGroup&&e.xAxis&&0<e.xAxis.length&&e.yAxis&&0<e.yAxis.length&&e.boost.markerGroup.translate(e.xAxis[0].pos,e.yAxis[0].pos)}),addEvent(e,"load",o,{order:-1}),addEvent(e,"redraw",o);let s=-1,i=-1;addEvent(e.pointer,"afterGetHoverData",o=>{var t,o=o.hoverPoint?.series;e.boost=e.boost||{},e.boost.markerGroup&&o&&(t=e.inverted?o.yAxis:o.xAxis,o=e.inverted?o.xAxis:o.yAxis,(t&&t.pos!==s||o&&o.pos!==i)&&(e.series.forEach(o=>{o.halo?.hide()}),e.boost.markerGroup.translate(t.pos,o.pos),s=t.pos,i=o.pos))})}function patientMax(...o){let t=-Number.MAX_VALUE;return o.forEach(function(o){if(null!=o&&void 0!==o.length&&0<o.length)return t=o.length,!0}),t}const BoostChart={compose:compose,getBoostClipRect:getBoostClipRect,isChartSeriesBoosting:isChartSeriesBoosting};export default BoostChart;