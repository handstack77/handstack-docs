"use strict";import BoostChart from"./Boost/BoostChart.js";const{getBoostClipRect,isChartSeriesBoosting}=BoostChart;import BoostSeries from"./Boost/BoostSeries.js";const destroyGraphics=BoostSeries["destroyGraphics"];import Color from"../Core/Color/Color.js";const color=Color["parse"];import H from"../Core/Globals.js";const{doc,noop}=H;import U from"../Core/Utilities.js";const{addEvent,fireEvent,isNumber,merge,pick,wrap}=U;var BoostCanvas;!function(t){const v="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=",$=5e4;let p,tt;function d(t,o,e,i,r){r&&o!==r.clientX&&(t.moveTo(r.clientX,r.yBottom),t.lineTo(r.clientX,r.plotY),t.lineTo(o,e),t.lineTo(o,i))}function g(t,o,e,i,r){t.moveTo(o,e),t.arc(o,e,this.radii&&this.radii[r],0,2*Math.PI,!1)}function u(t,o,e,i){t.rect(o-1,e,1,i-e)}function f(){this.boost&&this.boost.copy&&this.boost.copy()}function m(){const t=this.boost||{};t.target&&t.target.attr({href:v}),t.canvas&&t.canvas.getContext("2d").clearRect(0,0,t.canvas.width,t.canvas.height)}function b(){isChartSeriesBoosting(this.chart)?this.boost&&this.boost.clear&&this.boost.clear():this.boost&&this.boost.copy?this.boost.copy():this.chart.boost&&this.chart.boost.copy&&this.chart.boost.copy()}function y(t,o,e){t.lineTo(o,e)}function A(){function o(t,o,e,i,r,s,a){t.call(this,e,o,i,r,s,a)}const t=this.chart,e=isChartSeriesBoosting(t)?t:this,i=e===t?t.seriesGroup:t.seriesGroup||this.group,r=t.chartWidth,s=t.chartHeight;let a;const n=e.boost=e.boost||{};return a=n.targetCtx,n.canvas?(e,p):(n.canvas=doc.createElement("canvas"),n.target=t.renderer.image("",0,0,r,s).addClass("highcharts-boost-canvas").add(i),a=n.targetCtx=n.canvas.getContext("2d"),t.inverted&&["moveTo","lineTo","rect","arc"].forEach(t=>{wrap(a,t,o)}),n.copy=function(){n.target.attr({href:n.canvas.toDataURL("image/png")})},n.clear=function(){a.clearRect(0,0,n.canvas.width,n.canvas.height),e===n.target&&n.target.attr({href:v})},n.clipRect=t.renderer.clipRect(),n.target.clip(n.clipRect)),n.canvas.width!==r&&(n.canvas.width=r),n.canvas.height!==s&&(n.canvas.height=s),n.target.attr({x:0,y:0,width:r,height:s,style:"pointer-events: none",href:v}),n.clipRect&&n.clipRect.attr(getBoostClipRect(t,e)),a}function C(){const C=this,t=C.options,x=C.chart,S=C.xAxis,B=C.yAxis,o=x.options.boost||{},e={timeRendering:o.timeRendering||!1,timeSeriesProcessing:o.timeSeriesProcessing||!1,timeSetup:o.timeSetup||!1},i=C.processedXData,w=C.processedYData,a=t.data,r=S.getExtremes(),T=r.min,k=r.max,s=B.getExtremes(),R=s.min,E=s.max,n={},K=!!C.sampling,c=t.marker&&t.marker.radius,W=C.cvsStrokeBatch||1e3,q=t.enableMouseTracking,l=t.threshold,M=isNumber(l),N=B.getThreshold(l),Q=C.fill,D=C.pointArrayMap&&"low,high"===C.pointArrayMap.join(","),G=!!t.stacking,h=C.cropStart||0,p=x.options.loading,z=C.requireSorting,J=t.connectNulls,P=!i,Y=G?C.data:i||a,_=C.fillOpacity?Color.parse(C.color).setOpacity(pick(t.fillOpacity,.75)).get():C.color,F="x"===t.findNearestPointBy,d=this.boost||{},g=C.cvsDrawPoint,X=t.lineWidth?C.cvsLineTo:void 0,L=c&&c<=1?C.cvsMarkerSquare:C.cvsMarkerCircle,Z=(d.target&&d.target.attr({href:v}),(C.points||C.graph)&&destroyGraphics(C),C.plotGroup("group","series",C.visible?"visible":"hidden",t.zIndex,x.seriesGroup),C.markerGroup=C.group,addEvent(C,"destroy",function(){C.markerGroup=null}),this.points=[]),j=this.getContext();if(C.buildKDTree=noop,d.clear&&d.clear(),C.visible){99999<a.length&&(x.options.loading=merge(p,{labelStyle:{backgroundColor:color("#ffffff").setOpacity(.75).get(),padding:"1em",borderRadius:"0.5em"},style:{backgroundColor:"none",opacity:1}}),U.clearTimeout(tt),x.showLoading("Drawing..."),x.options.loading=p),e.timeRendering&&console.time("canvas rendering");let r=0,v,s,u=N,f,m,b,y,A,i;const O=function(){Q?(j.fillStyle=_,j.fill()):(j.strokeStyle=C.color,j.lineWidth=t.lineWidth,j.stroke())},V=function(t,o,e,i){0===r&&(j.beginPath(),X&&(j.lineJoin="round")),x.scroller&&"highcharts-navigator-series"===C.options.className?(o+=x.scroller.top,e&&(e+=x.scroller.top)):o+=x.plotTop,t+=x.plotLeft,f?j.moveTo(t,o):g?g(j,t,o,e,s):X?X(j,t,o):L&&L.call(C,j,t,o,c,i),(r+=1)===W&&(O(),r=0),s={clientX:t,plotY:o,yBottom:e}},H=this.xData||this.options.xData||this.processedXData||!1,I=function(t,o,e){i=F?t:t+","+o,q&&!n[i]&&(n[i]=!0,x.inverted&&(t=S.len-t,o=B.len-o),Z.push({x:!!H&&H[h+e],clientX:t,plotX:t,plotY:o,i:h+e}))};BoostSeries.eachAsync(Y,(t,o)=>{var e=void 0===x.index;let i,r,s,a,n,c,l=!1,h=!1,p=NaN,d=NaN,g=!0;return e||(P?(i=t[0],r=t[1],Y[o+1]&&(p=Y[o+1][0]),Y[o-1]&&(d=Y[o-1][0])):(i=t,r=w[o],Y[o+1]&&(p=Y[o+1]),Y[o-1]&&(d=Y[o-1])),p&&p>=T&&p<=k&&(l=!0),d&&d>=T&&d<=k&&(h=!0),D?(P&&(r=t.slice(1,3)),c=r[0],r=r[1]):G&&(i=t.x,r=t.stackY,c=r-t.y),n=null===r,z||(g=r>=R&&r<=E),!n&&(i>=T&&i<=k&&g||l||h)&&(s=Math.round(S.toPixels(i,!0)),K?(void 0!==y&&s!==v||(D||(c=r),(void 0===A||r>b)&&(b=r,A=o),(void 0===y||c<m)&&(m=c,y=o)),s!==v&&(void 0!==y&&(a=B.toPixels(b,!0),u=B.toPixels(m,!0),V(s,M?Math.min(a,N):a,M?Math.max(u,N):u,o),I(s,a,A),u!==a&&I(s,u,y)),y=A=void 0,v=s)):(a=Math.round(B.toPixels(r,!0)),V(s,a,u,o),I(s,a,o))),f=n&&!J,o%$==0&&(C.boost&&C.boost.copy?C.boost.copy():C.chart.boost&&C.chart.boost.copy&&C.chart.boost.copy())),!e},function(){const t=x.loadingDiv,o=x.loadingShown;O(),C.canvasToSVG(),e.timeRendering&&console.timeEnd("canvas rendering"),fireEvent(C,"renderedCanvas"),o&&(t.style.transition="opacity 250ms",t.opacity=0,x.loadingShown=!1,tt=setTimeout(function(){t.parentNode&&t.parentNode.removeChild(t),x.loadingDiv=x.loadingSpan=null},250)),delete C.buildKDTree,C.buildKDTree()},x.renderer.forExport?Number.MAX_VALUE:void 0)}}function x(t,o,e,i){t.moveTo(o,e),t.arc(o,e,i,0,2*Math.PI,!1)}function S(t,o,e,i){t.rect(o-i,e-i,2*i,2*i)}function B(){const a=this.chart,n=this.getContext(),c=this.chart.inverted,l=this.xAxis,h=this.yAxis;n?(this.points.forEach(t=>{var o,e,i,r=t.plotY;let s;void 0!==r&&!isNaN(r)&&null!==t.y&&n&&({x:r=0,y:o=0,width:e=0,height:i=0}=t.shapeArgs||{},s=a.styledMode?t.series.colorAttribs(t):t.series.pointAttribs(t),n.fillStyle=s.fill,c?n.fillRect(h.len-o+l.left,l.len-r+h.top,-i,-e):n.fillRect(r+l.left,o+h.top,e,i))}),this.canvasToSVG()):this.chart.showLoading("Your browser doesn't support HTML5 canvas, <br>please use a modern browser")}t.compose=function(t,o,e){const i=o.prototype;if(!i.renderCanvas){var{area:o,bubble:e,column:r,heatmap:s,scatter:a}=e;if((p=t).prototype.callbacks.push(t=>{addEvent(t,"predraw",m),addEvent(t,"render",f)}),i.canvasToSVG=b,i.cvsLineTo=y,i.getContext=A,i.renderCanvas=C,o){const n=o.prototype;n.cvsDrawPoint=d,n.fill=!0,n.fillOpacity=!0,n.sampling=!0}if(e){const c=e.prototype;c.cvsMarkerCircle=g,c.cvsStrokeBatch=1}if(r){const l=r.prototype;l.cvsDrawPoint=u,l.fill=!0,l.sampling=!0}if(s&&(t=s.prototype,wrap(t,"drawPoints",B)),a){const h=a.prototype;h.cvsMarkerCircle=x,h.cvsMarkerSquare=S,h.fill=!0}}}}(BoostCanvas=BoostCanvas||{});export default BoostCanvas;