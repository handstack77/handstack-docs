"use strict";import AccessibilityComponent from"../AccessibilityComponent.js";import Announcer from"../Utils/Announcer.js";import KeyboardNavigationHandler from"../KeyboardNavigationHandler.js";import Navigator from"../../Stock/Navigator/Navigator.js";import A from"../../Core/Animation/AnimationUtilities.js";const animObject=A["animObject"];import T from"../../Core/Templating.js";const format=T["format"];import U from"../../Core/Utilities.js";const{clamp,pick,syncTimeout}=U;import HU from"../Utils/HTMLUtilities.js";const getFakeMouseEvent=HU["getFakeMouseEvent"];import CU from"../Utils/ChartUtilities.js";const{getAxisRangeDescription,fireEventOnWrappedOrUnwrappedElement}=CU;class NavigatorComponent extends AccessibilityComponent{init(){const t=this.chart,e=this;this.announcer=new Announcer(t,"polite"),this.addEvent(Navigator,"afterRender",function(){this.chart===e.chart&&this.chart.renderer&&syncTimeout(()=>{e.proxyProvider.updateGroupProxyElementPositions("navigator"),e.updateHandleValues()},animObject(pick(this.chart.renderer.globalAnimation,!0)).duration)})}onChartUpdate(){const i=this.chart,t=i.options,e=t.navigator;if(e.enabled&&e.accessibility?.enabled){var a=t.accessibility.landmarkVerbosity,o=t.lang.accessibility?.navigator.groupLabel;this.proxyProvider.removeGroup("navigator"),this.proxyProvider.addGroup("navigator","div",{role:"all"===a?"region":"group","aria-label":format(o,{chart:i},i)});const n=t.lang.accessibility?.navigator.handleLabel;[0,1].forEach(t=>{var e=this.getHandleByIx(t);if(e){const a=this.proxyProvider.addProxyElement("navigator",{click:e},"input",{type:"range","aria-label":format(n,{handleIx:t,chart:i},i)});this[t?"maxHandleProxy":"minHandleProxy"]=a.innerElement,a.innerElement.style.pointerEvents="none",a.innerElement.oninput=()=>this.updateNavigator()}}),this.updateHandleValues()}else this.proxyProvider.removeGroup("navigator")}getNavigatorHandleNavigation(e){const a=this,i=this.chart,o=e?this.maxHandleProxy:this.minHandleProxy,n=this.keyCodes;return new KeyboardNavigationHandler(i,{keyCodeMap:[[[n.left,n.right,n.up,n.down],function(t){return o&&(t=t===n.left||t===n.up?-1:1,o.value=""+clamp(parseFloat(o.value)+t,0,100),a.updateNavigator(()=>{var t=a.getHandleByIx(e);t&&i.setFocusToElement(t,o)})),this.response.success}]],init:()=>{i.setFocusToElement(this.getHandleByIx(e),o)},validate:()=>!!(this.getHandleByIx(e)&&o&&i.options.navigator.accessibility?.enabled)})}getKeyboardNavigation(){return[this.getNavigatorHandleNavigation(0),this.getNavigatorHandleNavigation(1)]}destroy(){this.updateNavigatorThrottleTimer&&clearTimeout(this.updateNavigatorThrottleTimer),this.proxyProvider.removeGroup("navigator"),this.announcer&&this.announcer.destroy()}updateHandleValues(){var t,e=this.chart.navigator;e&&this.minHandleProxy&&this.maxHandleProxy&&(t=e.size,this.minHandleProxy.value=""+Math.round(e.zoomedMin/t*100),this.maxHandleProxy.value=""+Math.round(e.zoomedMax/t*100))}getHandleByIx(t){var e=this.chart.navigator;return e&&e.handles&&e.handles[t]}updateNavigator(t){this.updateNavigatorThrottleTimer&&clearTimeout(this.updateNavigatorThrottleTimer),this.updateNavigatorThrottleTimer=setTimeout((t=>{const e=this.chart,{navigator:i,pointer:a}=e;if(i&&a&&this.minHandleProxy&&this.maxHandleProxy){const n=a.getChartPosition(),r=parseFloat(this.minHandleProxy.value)/100*i.size,s=parseFloat(this.maxHandleProxy.value)/100*i.size;[[0,"mousedown",i.zoomedMin],[0,"mousemove",r],[0,"mouseup",r],[1,"mousedown",i.zoomedMax],[1,"mousemove",s],[1,"mouseup",s]].forEach(([t,e,a])=>{t=this.getHandleByIx(t)?.element;t&&fireEventOnWrappedOrUnwrappedElement(t,getFakeMouseEvent(e,{x:n.left+i.left+a,y:n.top+i.top},t))}),t&&t();var t=e.options.lang.accessibility?.navigator.changeAnnouncement,o=getAxisRangeDescription(e.xAxis[0]);this.announcer.announce(format(t,{axisRangeDescription:o,chart:e},e))}}).bind(this,t),20)}}export default NavigatorComponent;