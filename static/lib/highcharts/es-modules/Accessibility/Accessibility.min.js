"use strict";import D from"../Core/Defaults.js";const defaultOptions=D["defaultOptions"];import H from"../Core/Globals.js";const doc=H["doc"];import U from"../Core/Utilities.js";const{addEvent,extend,fireEvent,merge}=U;import HU from"./Utils/HTMLUtilities.js";const removeElement=HU["removeElement"];import A11yI18n from"./A11yI18n.js";import ContainerComponent from"./Components/ContainerComponent.js";import FocusBorderComposition from"./FocusBorder.js";import InfoRegionsComponent from"./Components/InfoRegionsComponent.js";import KeyboardNavigation from"./KeyboardNavigation.js";import LegendComponent from"./Components/LegendComponent.js";import MenuComponent from"./Components/MenuComponent.js";import NavigatorComponent from"./Components/NavigatorComponent.js";import NewDataAnnouncer from"./Components/SeriesComponent/NewDataAnnouncer.js";import ProxyProvider from"./ProxyProvider.js";import RangeSelectorComponent from"./Components/RangeSelectorComponent.js";import SeriesComponent from"./Components/SeriesComponent/SeriesComponent.js";import ZoomComponent from"./Components/ZoomComponent.js";import whcm from"./HighContrastMode.js";import highContrastTheme from"./HighContrastTheme.js";import defaultOptionsA11Y from"./Options/A11yDefaults.js";import defaultLangOptions from"./Options/LangDefaults.js";import copyDeprecatedOptions from"./Options/DeprecatedOptions.js";class Accessibility{constructor(e){this.init(e)}init(e){if(this.chart=e,!doc.addEventListener)return this.zombie=!0,this.components={},void e.renderTo.setAttribute("aria-hidden",!0);copyDeprecatedOptions(e),this.proxyProvider=new ProxyProvider(this.chart),this.initComponents(),this.keyboardNavigation=new KeyboardNavigation(e,this.components)}initComponents(){const t=this.chart,o=this.proxyProvider;var e=t.options.accessibility;this.components={container:new ContainerComponent,infoRegions:new InfoRegionsComponent,legend:new LegendComponent,chartMenu:new MenuComponent,rangeSelector:new RangeSelectorComponent,series:new SeriesComponent,zoom:new ZoomComponent,navigator:new NavigatorComponent},e.customComponents&&extend(this.components,e.customComponents);const n=this.components;this.getComponentOrder().forEach(function(e){n[e].initBase(t,o),n[e].init()})}getComponentOrder(){if(!this.components)return[];if(!this.components.series)return Object.keys(this.components);var e=Object.keys(this.components).filter(e=>"series"!==e);return["series"].concat(e)}update(){const t=this.components,o=this.chart,e=o.options.accessibility;fireEvent(o,"beforeA11yUpdate"),o.types=this.getChartTypes();var n=e.keyboardNavigation.order;this.proxyProvider.updateGroupOrder(n),this.getComponentOrder().forEach(function(e){t[e].onChartUpdate(),fireEvent(o,"afterA11yComponentUpdate",{name:e,component:t[e]})}),this.keyboardNavigation.update(n),o.highContrastModeActive||!1===e.highContrastMode||!whcm.isHighContrastModeActive()&&!0!==e.highContrastMode||whcm.setHighContrastTheme(o),fireEvent(o,"afterA11yUpdate",{accessibility:this})}destroy(){const e=this.chart||{},t=this.components;Object.keys(t).forEach(function(e){t[e].destroy(),t[e].destroyBase()}),this.proxyProvider&&this.proxyProvider.destroy(),e.announcerContainer&&removeElement(e.announcerContainer),this.keyboardNavigation&&this.keyboardNavigation.destroy(),e.renderTo&&e.renderTo.setAttribute("aria-hidden",!0),e.focusElement&&e.focusElement.removeFocusBorder()}getChartTypes(){const t={};return this.chart.series.forEach(function(e){t[e.type]=1}),Object.keys(t)}}!function(s){function a(){this.accessibility&&this.accessibility.destroy()}function c(){this.a11yDirty&&this.renderTo&&(delete this.a11yDirty,this.updateA11yEnabled());const t=this.accessibility;t&&!t.zombie&&(t.proxyProvider.updateProxyElementPositions(),t.getComponentOrder().forEach(function(e){t.components[e].onChartRender()}))}function m(e){const t=e.options.accessibility;t&&(t.customComponents&&(this.options.accessibility.customComponents=t.customComponents,delete t.customComponents),merge(!0,this.options.accessibility,t),this.accessibility&&this.accessibility.destroy&&(this.accessibility.destroy(),delete this.accessibility)),this.a11yDirty=!0}function p(){let e=this.accessibility;const t=this.options.accessibility,o=this.renderer.boxWrapper.element,n=this.title;if(t&&t.enabled)e&&!e.zombie?e.update():(this.accessibility=e=new s(this),e&&!e.zombie&&e.update(),"img"===o.getAttribute("role")&&o.removeAttribute("role"));else if(e)e.destroy&&e.destroy(),delete this.accessibility;else{this.renderTo.setAttribute("role","img"),this.renderTo.setAttribute("aria-hidden",!1),this.renderTo.setAttribute("aria-label",(n&&n.element.textContent||"").replace(/</g,"&lt;")),o.setAttribute("aria-hidden",!0);const i=document.getElementsByClassName("highcharts-description")[0];i&&(i.setAttribute("aria-hidden",!1),i.classList.remove("highcharts-linked-description"))}}function d(){this.series.chart.accessibility&&(this.series.chart.a11yDirty=!0)}s.i18nFormat=A11yI18n.i18nFormat,s.compose=function(t,e,o,n,i,s){KeyboardNavigation.compose(t),NewDataAnnouncer.compose(n),LegendComponent.compose(t,e),MenuComponent.compose(t),SeriesComponent.compose(t,o,n),A11yI18n.compose(t),FocusBorderComposition.compose(t,i),s&&RangeSelectorComponent.compose(t,s);const r=t.prototype;r.updateA11yEnabled||(r.updateA11yEnabled=p,addEvent(t,"destroy",a),addEvent(t,"render",c),addEvent(t,"update",m),["addSeries","init"].forEach(e=>{addEvent(t,e,function(){this.a11yDirty=!0})}),["afterApplyDrilldown","drillupall"].forEach(e=>{addEvent(t,e,function(){const e=this.accessibility;e&&!e.zombie&&e.update()})}),addEvent(o,"update",d),["update","updatedData","remove"].forEach(e=>{addEvent(n,e,function(){this.chart.accessibility&&(this.chart.a11yDirty=!0)})}))}}(Accessibility=Accessibility||{}),merge(!0,defaultOptions,defaultOptionsA11Y,{accessibility:{highContrastTheme:highContrastTheme},lang:defaultLangOptions});export default Accessibility;