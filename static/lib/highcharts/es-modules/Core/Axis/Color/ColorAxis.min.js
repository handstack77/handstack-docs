"use strict";import Axis from"../Axis.js";import ColorAxisComposition from"./ColorAxisComposition.js";import ColorAxisDefaults from"./ColorAxisDefaults.js";import ColorAxisLike from"./ColorAxisLike.js";import D from"../../Defaults.js";const defaultOptions=D["defaultOptions"];import LegendSymbol from"../../Legend/LegendSymbol.js";import SeriesRegistry from"../../Series/SeriesRegistry.js";const Series=SeriesRegistry["series"];import U from"../../Utilities.js";const{defined,extend,fireEvent,isArray,isNumber,merge,pick,relativeLength}=U;defaultOptions.colorAxis=merge(defaultOptions.xAxis,ColorAxisDefaults);class ColorAxis extends Axis{static compose(e,t,s,i){ColorAxisComposition.compose(ColorAxis,e,t,s,i)}constructor(e,t){super(e,t),this.coll="colorAxis",this.visible=!0,this.init(e,t)}init(e,t){var s=this,i=e.options.legend||{},i=t.layout?"vertical"!==t.layout:"vertical"!==i.layout;s.side=t.side||i?2:1,s.reversed=t.reversed||!i,s.opposite=!i,super.init(e,t,"colorAxis"),this.userOptions=t,isArray(e.userOptions.colorAxis)&&(e.userOptions.colorAxis[this.index]=t),t.dataClasses&&s.initDataClasses(t),s.initStops(),s.horiz=i,s.zoomEnabled=!1}hasData(){return!!(this.tickPositions||[]).length}setTickPositions(){if(!this.dataClasses)return super.setTickPositions()}setOptions(e){e=merge(defaultOptions.colorAxis,e,{showEmpty:!1,title:null,visible:this.chart.options.legend.enabled&&!1!==e.visible});super.setOptions(e),this.options.crosshair=this.options.marker}setAxisSize(){const e=this,t=e.chart,s=e.legendItem?.symbol;let{width:i,height:o}=e.getSize();s&&(this.left=+s.attr("x"),this.top=+s.attr("y"),this.width=i=+s.attr("width"),this.height=o=+s.attr("height"),this.right=t.chartWidth-this.left-i,this.bottom=t.chartHeight-this.top-o,this.pos=this.horiz?this.left:this.top),this.len=(this.horiz?i:o)||ColorAxis.defaultLegendLength}getOffset(){var e=this,t=e.legendItem?.group,s=e.chart.axisOffset[e.side];if(t){e.axisParent=t,super.getOffset();const i=this.chart.legend;i.allItems.forEach(function(e){e instanceof ColorAxis&&e.drawLegendSymbol(i,e)}),i.render(),this.chart.getMargins(!0),this.chart.series.some(e=>e.isDrilling)||(e.isDirty=!0),e.added||(e.added=!0,e.labelLeft=0,e.labelRight=e.width),e.chart.axisOffset[e.side]=s}}setLegendColor(){var e=this,t=e.horiz,s=e.reversed,i=s?1:0,s=s?0:1,t=t?[i,0,s,0]:[0,s,0,i];e.legendColor={linearGradient:{x1:t[0],y1:t[1],x2:t[2],y2:t[3]},stops:e.stops}}drawLegendSymbol(e,t){const s=this,i=t.legendItem||{},o=e.padding,r=e.options,a=s.options.labels,l=pick(r.itemDistance,10),n=s.horiz,{width:d,height:h}=s.getSize(),p=pick(r.labelPadding,n?16:30);this.setLegendColor(),i.symbol||(i.symbol=this.chart.renderer.symbol("roundedRect").attr({r:r.symbolRadius??3,zIndex:1}).add(i.group)),i.symbol.attr({x:0,y:(e.baseline||0)-11,width:d,height:h}),i.labelWidth=d+o+(n?l:pick(a.x,a.distance)+(this.maxLabelLength||0)),i.labelHeight=h+o+(n?p:0)}setState(t){this.series.forEach(function(e){e.setState(t)})}setVisible(){}getSeriesExtremes(){var e,t=this.series;let s,i,o,r,a,l,n=t.length,d,h;for(this.dataMin=1/0,this.dataMax=-1/0;n--;){if(i=(l=t[n]).colorKey=pick(l.options.colorKey,l.colorKey,l.pointValKey,l.zoneAxis,"y"),r=l.pointArrayMap,a=l[i+"Min"]&&l[i+"Max"],l[i+"Data"])s=l[i+"Data"];else if(r){if(s=[],o=r.indexOf(i),d=l.yData,0<=o&&d)for(h=0;h<d.length;h++)s.push(pick(d[h][o],d[h]))}else s=l.yData;a?(l.minColorValue=l[i+"Min"],l.maxColorValue=l[i+"Max"]):(e=Series.prototype.getExtremes.call(l,s),l.minColorValue=e.dataMin,l.maxColorValue=e.dataMax),defined(l.minColorValue)&&defined(l.maxColorValue)&&(this.dataMin=Math.min(this.dataMin,l.minColorValue),this.dataMax=Math.max(this.dataMax,l.maxColorValue)),a||Series.prototype.applyExtremes.call(l)}}drawCrosshair(e,t){var s=this,i=s.legendItem||{},o=t&&t.plotX,r=t&&t.plotY,a=s.pos,l=s.len;let n;t&&((n=s.toPixels(t.getNestedProperty(t.series.colorKey)))<a?n=a-2:n>a+l&&(n=a+l+2),t.plotX=n,t.plotY=s.len-n,super.drawCrosshair(e,t),t.plotX=o,t.plotY=r,s.cross&&!s.cross.addedToColorAxis&&i.group&&(s.cross.addClass("highcharts-coloraxis-marker").add(i.group),s.cross.addedToColorAxis=!0,s.chart.styledMode||"object"!=typeof s.crosshair||s.cross.attr({fill:s.crosshair.color})))}getPlotLinePath(e){var t=this.left,s=e.translatedValue,i=this.top;return isNumber(s)?this.horiz?[["M",s-4,i-6],["L",s+4,i-6],["L",s,i],["Z"]]:[["M",t,s],["L",t-6,s+6],["L",t-6,s-6],["Z"]]:super.getPlotLinePath(e)}update(e,t){const s=this,i=s.chart,o=i.legend;this.series.forEach(e=>{e.isDirtyData=!0}),(e.dataClasses&&o.allItems||s.dataClasses)&&s.destroyItems(),super.update(e,t),s.legendItem&&s.legendItem.label&&(s.setLegendColor(),o.colorizeItem(this,!0))}destroyItems(){const e=this.chart,t=this.legendItem||{};if(t.label)e.legend.destroyItem(this);else if(t.labels)for(const s of t.labels)e.legend.destroyItem(s);e.isDirtyLegend=!0}destroy(){this.chart.isDirtyLegend=!0,this.destroyItems(),super.destroy(...[].slice.call(arguments))}remove(e){this.destroyItems(),super.remove(e)}getDataClassLegendSymbols(){const a=this,l=a.chart,n=a.legendItem&&a.legendItem.labels||[],e=l.options.legend,d=pick(e.valueDecimals,-1),h=pick(e.valueSuffix,""),p=s=>a.series.reduce((e,t)=>(e.push(...t.points.filter(e=>e.dataClass===s)),e),[]);let c;return n.length||a.dataClasses.forEach((e,s)=>{const t=e.from,i=e.to,o=l["numberFormatter"];let r=!0;c="",void 0===t?c="< ":void 0===i&&(c="> "),void 0!==t&&(c+=o(t,d)+h),void 0!==t&&void 0!==i&&(c+=" - "),void 0!==i&&(c+=o(i,d)+h),n.push(extend({chart:l,name:c,options:{},drawLegendSymbol:LegendSymbol.rectangle,visible:!0,isDataClass:!0,setState:e=>{for(const t of p(s))t.setState(e)},setVisible:function(){this.visible=r=a.visible=!r;const e=[];for(const t of p(s))t.setVisible(r),t.hiddenInDataClass=!r,-1===e.indexOf(t.series)&&e.push(t.series);l.legend.colorizeItem(this,r),e.forEach(e=>{fireEvent(e,"afterDataClassLegendClick")})}},e))}),n}getSize(){var{chart:e,horiz:t}=this,{height:s,width:i}=this.options,o=e.options["legend"];return{width:pick(defined(i)?relativeLength(i,e.chartWidth):void 0,o?.symbolWidth,t?ColorAxis.defaultLegendLength:12),height:pick(defined(s)?relativeLength(s,e.chartHeight):void 0,o?.symbolHeight,t?12:ColorAxis.defaultLegendLength)}}}ColorAxis.defaultLegendLength=200,ColorAxis.keepProps=["legendItem"],extend(ColorAxis.prototype,ColorAxisLike),Array.prototype.push.apply(Axis.keepProps,ColorAxis.keepProps);export default ColorAxis;