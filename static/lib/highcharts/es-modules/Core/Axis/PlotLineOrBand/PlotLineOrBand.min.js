"use strict";import PlotLineOrBandAxis from"./PlotLineOrBandAxis.js";import U from"../../Utilities.js";const{addEvent,arrayMax,arrayMin,defined,destroyObjectProperties,erase,fireEvent,merge,objectEach,pick}=U;class PlotLineOrBand{static compose(e,t){return addEvent(e,"afterInit",function(){this.labelCollectors.push(()=>{const e=[];for(const s of this.axes)for(var{label:t,options:i}of s.plotLinesAndBands)t&&!i?.label?.allowOverlap&&e.push(t);return e})}),PlotLineOrBandAxis.compose(PlotLineOrBand,t)}constructor(e,t){this.axis=e,this.options=t,this.id=t.id}render(){fireEvent(this,"render");const{axis:e,options:t}=this,{horiz:i,logarithmic:s}=e,{color:a,events:r,zIndex:n=0}=t,d={},l=e.chart.renderer,o=t.to,h=t.from,c=t.value,f=t.borderWidth;let g=t.label,{label:p,svgElem:x}=this,b=[],y;const m=defined(h)&&defined(o),u=defined(c),v=!x,L={class:"highcharts-plot-"+(m?"band ":"line ")+(t.className||"")};var P=m?"bands":"lines";if(e.chart.styledMode||(u?(L.stroke=a||"#999999",L["stroke-width"]=pick(t.width,1),t.dashStyle&&(L.dashstyle=t.dashStyle)):m&&(L.fill=a||"#e6e9ff",f&&(L.stroke=t.borderColor,L["stroke-width"]=f))),P+="-"+(d.zIndex=n),(y=e.plotLinesAndBandsGroups[P])||(e.plotLinesAndBandsGroups[P]=y=l.g("plot-"+P).attr(d).add()),x||(this.svgElem=x=l.path().attr(L).add(y)),defined(c))b=e.getPlotLinePath({value:s?.log2lin(c)??c,lineWidth:x.strokeWidth(),acrossPanes:t.acrossPanes});else{if(!defined(h)||!defined(o))return;b=e.getPlotBandPath(s?.log2lin(h)??h,s?.log2lin(o)??o,t)}return!this.eventsAdded&&r&&(objectEach(r,(e,t)=>{x?.on(t,e=>{r[t].apply(this,[e])})}),this.eventsAdded=!0),!v&&x.d||!b?.length?x&&(b?(x.show(),x.animate({d:b})):x.d&&(x.hide(),p&&(this.label=p=p.destroy()))):x.attr({d:b}),g&&(defined(g.text)||defined(g.formatter))&&b?.length&&0<e.width&&0<e.height&&!b.isFlat?(g=merge({align:i&&m?"center":void 0,x:i?!m&&4:10,verticalAlign:!i&&m?"middle":void 0,y:i?m?16:10:m?6:-4,rotation:i&&!m?90:0,...m?{inside:!0}:{}},g),this.renderLabel(g,b,m,n)):p&&p.hide(),this}renderLabel(e,t,i,s){const a=this,r=a.axis,n=r.chart.renderer,d=e.inside;let l=a.label;l||(a.label=l=n.text(this.getLabelText(e),0,0,e.useHTML).attr({align:e.textAlign||e.align,rotation:e.rotation,class:"highcharts-plot-"+(i?"band":"line")+"-label "+(e.className||""),zIndex:s}),r.chart.styledMode||l.css(merge({fontSize:"0.8em",textOverflow:i&&!d?"":"ellipsis"},e.style)),l.add());var s=t.xBounds||[t[0][1],t[1][1],(i?t[2]:t[0])[1]],t=t.yBounds||[t[0][2],t[1][2],(i?t[2]:t[0])[2]],o=arrayMin(s),h=arrayMin(t),s=arrayMax(s)-o;l.align(e,!1,{x:o,y:h,width:s,height:arrayMax(t)-h}),l.alignValue&&"left"!==l.alignValue&&!defined(d)||l.css({width:(e.style?.width||(i&&d?s:90===l.rotation?r.height-(l.alignAttr.y-r.top):(e.clip?r.width:r.chart.chartWidth)-(l.alignAttr.x-r.left)))+"px"}),l.show(!0)}getLabelText(e){return defined(e.formatter)?e.formatter.call(this):e.text}destroy(){erase(this.axis.plotLinesAndBands,this),delete this.axis,destroyObjectProperties(this)}}export default PlotLineOrBand;