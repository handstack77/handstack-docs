"use strict";import G from"../Core/Globals.js";const win=G["win"];import U from"../Core/Utilities.js";const{discardElement,objectEach}=U;function ajax(n){const e={json:"application/json",xml:"application/xml",text:"text/plain",octet:"application/octet-stream"},a=new XMLHttpRequest;function t(e,t){n.error&&n.error(e,t)}if(!n.url)return!1;a.open((n.type||"get").toUpperCase(),n.url,!0),n.headers&&n.headers["Content-Type"]||a.setRequestHeader("Content-Type",e[n.dataType||"json"]||e.text),objectEach(n.headers,function(e,t){a.setRequestHeader(t,e)}),n.responseType&&(a.responseType=n.responseType),a.onreadystatechange=function(){let e;if(4===a.readyState){if(200===a.status){if("blob"!==n.responseType&&(e=a.responseText,"json"===n.dataType))try{e=JSON.parse(e)}catch(e){if(e instanceof Error)return t(a,e)}return n.success&&n.success(e,a)}t(a,a.responseText)}},n.data&&"string"!=typeof n.data&&(n.data=JSON.stringify(n.data)),a.send(n.data)}function getJSON(e,t){HttpUtilities.ajax({url:e,success:t,dataType:"json",headers:{"Content-Type":"text/plain"}})}function post(e,t,n){const a=new win.FormData,{filename:s,type:o}=(objectEach(t,function(e,t){a.append(t,e)}),a.append("b64","true"),t);return win.fetch(e,{method:"POST",body:a,...n}).then(e=>{e.ok&&e.text().then(e=>{const t=document.createElement("a");t.href=`data:${o};base64,`+e,t.download=s,t.click(),discardElement(t)})})}const HttpUtilities={ajax:ajax,getJSON:getJSON,post:post};export default HttpUtilities;