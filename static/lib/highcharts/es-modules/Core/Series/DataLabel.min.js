"use strict";import A from"../Animation/AnimationUtilities.js";const getDeferredAnimation=A["getDeferredAnimation"];import F from"../Templating.js";const format=F["format"];import U from"../Utilities.js";const{defined,extend,fireEvent,isArray,isString,merge,objectEach,pick,pInt,splat}=U;var DataLabel;!function(){function e(){return l(this).some(t=>t?.enabled)}function a(t,i,e,a,o){const r=this,{chart:s,enabledDataSorting:n}=this,d=this.isCartesian&&s.inverted,l=t.plotX,h=t.plotY,c=e.rotation||0,p=defined(l)&&defined(h)&&s.isInsidePlot(l,Math.round(h),{inverted:d,paneCoordinates:!0,series:r}),g=0===c&&"justify"===pick(e.overflow,n?"none":"justify");let f=this.visible&&!1!==t.visible&&defined(l)&&(t.series.forceDL||n&&!g||p||pick(e.inside,!!this.options.stacking)&&a&&s.isInsidePlot(l,d?a.x+1:a.y+a.height-1,{inverted:d,paneCoordinates:!0,series:r}));var b,u,y,v,m,x=t.pos();f&&x&&(b=i.getBBox(),u=i.getBBox(void 0,0),y={right:1,center:.5}[e.align||0]||0,v={bottom:1,middle:.5}[e.verticalAlign||0]||0,a=extend({x:x[0],y:Math.round(x[1]),width:0,height:0},a||{}),"plotEdges"===e.alignTo&&r.isCartesian&&(a[d?"x":"y"]=0,a[d?"width":"height"]=this.yAxis?.len||0),extend(e,{width:b.width,height:b.height}),m=a,n&&r.xAxis&&!g&&r.setDataLabelStartPos(t,i,o,p,m),i.align(merge(e,{width:u.width,height:u.height}),!1,a,!1),i.alignAttr.x+=y*(u.width-b.width),i.alignAttr.y+=v*(u.height-b.height),i[i.placed?"animate":"attr"]({x:i.alignAttr.x+(b.width-u.width)/2,y:i.alignAttr.y+(b.height-u.height)/2,rotationOriginX:(i.width||0)/2,rotationOriginY:(i.height||0)/2}),g&&0<=a.height?this.justifyDataLabel(i,e,i.alignAttr,b,a,o):pick(e.crop,!0)&&({x:t,y:m}=i.alignAttr,f=s.isInsidePlot(t,m,{paneCoordinates:!0,series:r})&&s.isInsidePlot(t+b.width-1,m+b.height-1,{paneCoordinates:!0,series:r})),e.shape&&!c&&i[o?"attr":"animate"]({anchorX:x[0],anchorY:x[1]})),o&&n&&(i.placed=!1),f||n&&!g?(i.show(),i.placed=!0):(i.hide(),i.placed=!1)}function o(){return this.plotGroup("dataLabelsGroup","data-labels",this.hasRendered?"inherit":"hidden",this.options.dataLabels.zIndex||6)}function r(t){var i=this,e=i.hasRendered||0;const a=this.initDataLabelsGroup().attr({opacity:+e});return!e&&a&&(i.visible&&a.show(),i.options.animation?a.animate({opacity:1},t):a.attr({opacity:1})),a}function s(t){t=t||this.points;const x=this,A=x.chart,L=x.options,w=A.renderer,{backgroundColor:i,plotBackgroundColor:e}=A.options.chart,D=w.getContrast(isString(e)&&e||isString(i)&&i||"#000000"),a=l(x);let o,C;var{animation:r,defer:s}=a[0],s=s?getDeferredAnimation(A,r,x):{defer:0,duration:0};fireEvent(this,"drawDataLabels"),x.hasDataLabels?.()&&(C=this.initDataLabels(s),t.forEach(v=>{const m=v.dataLabels||[];(o=splat(d(a,v.dlOptions||v.options?.dataLabels))).forEach((t,i)=>{const e=t.enabled&&(v.visible||v.dataLabelOnHidden)&&(!v.isNull||v.dataLabelOnNull)&&(n=v,!(d=(d=t).filter)||(l=d.operator,n=n[d.property],d=d.value,">"===l&&d<n||"<"===l&&n<d||">="===l&&d<=n||"<="===l&&n<=d||"=="===l&&n==d||"==="===l&&n===d||"!="===l&&n!=d||"!=="===l&&n!==d)),{backgroundColor:a,borderColor:o,distance:r,style:s={}}=t;var n,d,l;let h,c,p,g,f={},b=m[i],u=!b,y;e&&(c=pick(t[v.formatPrefix+"Format"],t.format),h=v.getLabelConfig(),p=defined(c)?format(c,h,A):(t[v.formatPrefix+"Formatter"]||t.formatter).call(h,t),g=t.rotation,A.styledMode||(s.color=pick(t.color,s.color,isString(x.color)?x.color:void 0,"#000000"),"contrast"===s.color?("none"!==a&&(y=a),v.contrastColor=w.getContrast("auto"!==y&&y||v.color||x.color),s.color=y||!defined(r)&&t.inside||pInt(r||0)<0||L.stacking?v.contrastColor:D):delete v.contrastColor,L.cursor&&(s.cursor=L.cursor)),f={r:t.borderRadius||0,rotation:g,padding:t.padding,zIndex:1},A.styledMode||(f.fill="auto"===a?v.color:a,f.stroke="auto"===o?v.color:o,f["stroke-width"]=t.borderWidth),objectEach(f,(t,i)=>{void 0===t&&delete f[i]})),!b||e&&defined(p)&&!!b.div==!!t.useHTML&&(b.rotation&&t.rotation||b.rotation===t.rotation)||(b=void 0,u=!0),e&&defined(p)&&(b?f.text=p:(b=w.label(p,0,0,t.shape,void 0,void 0,t.useHTML,void 0,"data-label")).addClass(" highcharts-data-label-color-"+v.colorIndex+" "+(t.className||"")+(t.useHTML?" highcharts-tracker":"")),b&&(b.options=t,b.attr(f),A.styledMode?s.width&&b.css({width:s.width,textOverflow:s.textOverflow}):b.css(s).shadow(t.shadow),fireEvent(b,"beforeAddingDataLabel",{labelOptions:t,point:v}),b.added||b.add(C),x.alignDataLabel(v,b,t,void 0,u),b.isActive=!0,m[i]&&m[i]!==b&&m[i].destroy(),m[i]=b))});let t=m.length;for(;t--;)m[t]&&m[t].isActive?m[t].isActive=!1:(m[t]?.destroy(),m.splice(t,1));v.dataLabel=m[0],v.dataLabels=m})),fireEvent(this,"afterDrawDataLabels")}function n(t,i,e,a,o,r){var s=this.chart,n=i.align,d=i.verticalAlign,l=!t.box&&t.padding||0,h=s.inverted?this.yAxis:this.xAxis,h=h?h.left-s.plotLeft:0,c=s.inverted?this.xAxis:this.yAxis,c=c?c.top-s.plotTop:0;let{x:p=0,y:g=0}=i,f,b;return(f=(e.x||0)+l+h)<0&&("right"===n&&0<=p?(i.align="left",i.inside=!0):p-=f,b=!0),(f=(e.x||0)+a.width-l+h)>s.plotWidth&&("left"===n&&p<=0?(i.align="right",i.inside=!0):p+=s.plotWidth-f,b=!0),(f=e.y+l+c)<0&&("bottom"===d&&0<=g?(i.verticalAlign="top",i.inside=!0):g-=f,b=!0),(f=(e.y||0)+a.height-l+c)>s.plotHeight&&("top"===d&&g<=0?(i.verticalAlign="bottom",i.inside=!0):g+=s.plotHeight-f,b=!0),b&&(i.x=p,i.y=g,t.placed=!r,t.align(i,void 0,o)),b}function d(i,e){let t=[],a;if(isArray(i)&&!isArray(e))t=i.map(function(t){return merge(t,e)});else if(isArray(e)&&!isArray(i))t=e.map(function(t){return merge(i,t)});else if(isArray(i)||isArray(e)){if(isArray(i)&&isArray(e))for(a=Math.max(i.length,e.length);a--;)t[a]=merge(i[a],e[a])}else t=merge(i,e);return t}function l(t){var i=t.chart.options.plotOptions;return splat(d(d(i?.series?.dataLabels,i?.[t.type]?.dataLabels),t.options.dataLabels))}function h(t,i,e,a,o){var r=this.chart,s=r.inverted,n=this.xAxis,d=n.reversed,l=((s?i.height:i.width)||0)/2,t=t.pointWidth,t=t?t/2:0;i.startXPos=s?o.x:d?-l-t:n.width-l+t,i.startYPos=s?d?this.yAxis.height-l+t:-l-t:o.y,a?"hidden"===i.visibility&&(i.show(),i.attr({opacity:0}).animate({opacity:1})):i.attr({opacity:1}).animate({opacity:0},void 0,i.hide),r.hasRendered&&(e&&i.attr({x:i.startXPos,y:i.startYPos}),i.placed=!0)}(DataLabel||(DataLabel={})).compose=function(t){const i=t.prototype;i.initDataLabels||(i.initDataLabels=r,i.initDataLabelsGroup=o,i.alignDataLabel=a,i.drawDataLabels=s,i.justifyDataLabel=n,i.setDataLabelStartPos=h,i.hasDataLabels=e)}}();export default DataLabel;