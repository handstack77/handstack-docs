"use strict";import D from"./Defaults.js";const{defaultOptions,defaultTime}=D;import U from"./Utilities.js";const{extend,getNestedProperty,isArray,isNumber,isObject,pick,pInt}=U,helpers={add:(t,e)=>t+e,divide:(t,e)=>0!==e?t/e:"",eq:(t,e)=>t==e,each:function(n){const r=arguments[arguments.length-1];return!!isArray(n)&&n.map((t,e)=>format(r.body,extend(isObject(t)?t:{"@this":t},{"@index":e,"@first":0===e,"@last":e===n.length-1}))).join("")},ge:(t,e)=>e<=t,gt:(t,e)=>e<t,if:t=>!!t,le:(t,e)=>t<=e,lt:(t,e)=>t<e,multiply:(t,e)=>t*e,ne:(t,e)=>t!=e,subtract:(t,e)=>t-e,unless:t=>!t};function dateFormat(t,e,n){return defaultTime.dateFormat(t,e,n)}function format(c="",m,u){const t=/\{([\w\:\.\,;\-\/<>%@"'â€™= #\(\)]+)\}/g,e=/\(([\w\:\.\,;\-\/<>%@"'= ]+)\)/g,n=[],h=/f$/,g=/\.(\d)/,b=defaultOptions.lang,x=u&&u.time||defaultTime,y=u&&u.numberFormatter||numberFormat,k=(t="")=>{let e;return"true"===t||"false"!==t&&((e=Number(t)).toString()===t?e:getNestedProperty(t,m))};let r,s,i=0,o;for(;null!==(r=t.exec(c));){var l,a=e.exec(r[1]),p=(a&&(r=a,o=!0),s&&s.isBlock||(s={ctx:m,expression:r[1],find:r[0],isBlock:"#"===r[1].charAt(0),start:r.index,startInner:r.index+r[0].length,length:r[0].length}),r[1].split(" ")[0].replace("#","")),p=(helpers[p]&&(s.isBlock&&p===s.fn&&i++,s.fn||(s.fn=p)),"else"===r[1]);if(s.isBlock&&s.fn&&(r[1]==="/"+s.fn||p)?i?p||i--:(l=s.startInner,l=c.substr(l,r.index-l),void 0===s.body?(s.body=l,s.startInner=r.index+r[0].length):s.elseBody=l,s.find+=l+r[0],p||(n.push(s),s=void 0)):s.isBlock||n.push(s),a&&!s?.isBlock)break}return n.forEach(t=>{const{body:e,elseBody:n,expression:r,fn:s}=t;let i,o;if(s){const a=[t],p=r.split(" ");for(o=helpers[s].length;o--;)a.unshift(k(p[o+1]));i=helpers[s].apply(m,a),t.isBlock&&"boolean"==typeof i&&(i=format(i?e:n,m,u))}else{const d=r.split(":");if(i=k(d.shift()||""),d.length&&"number"==typeof i){const f=d.join(":");var l;h.test(f)?(l=parseInt((f.match(g)||["","-1"])[1],10),null!==i&&(i=y(i,l,b.decimalPoint,-1<f.indexOf(",")?b.thousandsSep:""))):i=x.dateFormat(f,i)}}c=c.replace(t.find,pick(i,""))}),o?format(c,m,u):c}function numberFormat(t,e,n,r){t=+t||0,e=+e;let s,i;const o=defaultOptions.lang,l=(t.toString().split(".")[1]||"").split("e")[0].length,a=t.toString().split("e"),p=e,d=(-1===e?e=Math.min(l,20):isNumber(e)?e&&a[1]&&a[1]<0&&(0<=(i=e+ +a[1])?(a[0]=(+a[0]).toExponential(i).split("e")[0],e=i):(a[0]=a[0].split(".")[0]||0,t=e<20?(a[0]*Math.pow(10,a[1])).toFixed(e):0,a[1]=0)):e=2,(Math.abs(a[1]?a[0]:t)+Math.pow(10,-Math.max(e,l)-1)).toFixed(e)),f=String(pInt(d));var c=3<f.length?f.length%3:0;return n=pick(n,o.decimalPoint),r=pick(r,o.thousandsSep),s=t<0?"-":"",s+=c?f.substr(0,c)+r:"",+a[1]<0&&!p?s="0":s+=f.substr(c).replace(/(\d{3})(?=\d)/g,"$1"+r),e?s+=n+d.slice(-e):0==+s&&(s="0"),a[1]&&0!=+s&&(s+="e"+a[1]),s}const Templating={dateFormat:dateFormat,format:format,helpers:helpers,numberFormat:numberFormat};export default Templating;