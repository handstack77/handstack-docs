"use strict";import H from"./Globals.js";const{charts,composed,doc,noop,win}=H;import Pointer from"./Pointer.js";import U from"./Utilities.js";const{addEvent,attr,css,defined,objectEach,pick,pushUnique,removeEvent}=U,touches={},hasPointerEvent=!!win.PointerEvent;function getWebkitTouches(){const e=[];return e.item=function(t){return this[t]},objectEach(touches,function(t){e.push({pageX:t.pageX,pageY:t.pageY,target:t.target})}),e}function translateMSPointer(t,e,n,o){const r=charts[Pointer.hoverChartIndex??-1]?.pointer;!r||"touch"!==t.pointerType&&t.pointerType!==t.MSPOINTER_TYPE_TOUCH||(o(t),r[e]({type:n,target:t.currentTarget,preventDefault:noop,touches:getWebkitTouches()}))}class MSPointer extends Pointer{static isRequired(){return!(win.TouchEvent||!win.PointerEvent&&!win.MSPointerEvent)}batchMSEvents(t){t(this.chart.container,hasPointerEvent?"pointerdown":"MSPointerDown",this.onContainerPointerDown),t(this.chart.container,hasPointerEvent?"pointermove":"MSPointerMove",this.onContainerPointerMove),t(doc,hasPointerEvent?"pointerup":"MSPointerUp",this.onDocumentPointerUp)}destroy(){this.batchMSEvents(removeEvent),super.destroy()}constructor(t,e){super(t,e),this.hasZoom&&css(t.container,{"-ms-touch-action":"none","touch-action":"none"})}inClass(t,e){let n=t,o;for(;n;){if(o=attr(n,"class")){if(-1!==o.indexOf(e))return!0;if(-1!==o.indexOf("highcharts-container"))return!1}(n=n.parentNode)&&(n===document.documentElement||defined(n.nodeType)&&n.nodeType===document.nodeType)&&(n=null)}}onContainerPointerDown(t){translateMSPointer(t,"onContainerTouchStart","touchstart",function(t){touches[t.pointerId]={pageX:t.pageX,pageY:t.pageY,target:t.currentTarget}})}onContainerPointerMove(t){translateMSPointer(t,"onContainerTouchMove","touchmove",function(t){touches[t.pointerId]={pageX:t.pageX,pageY:t.pageY},touches[t.pointerId].target||(touches[t.pointerId].target=t.currentTarget)})}onDocumentPointerUp(t){translateMSPointer(t,"onDocumentTouchEnd","touchend",function(t){delete touches[t.pointerId]})}setDOMEvents(){var t=this.chart.tooltip;super.setDOMEvents(),(this.hasZoom||pick(t&&t.options.followTouchMove,!0))&&this.batchMSEvents(addEvent)}}!function(e){e.compose=function(t){pushUnique(composed,"Core.MSPointer")&&addEvent(t,"beforeRender",function(){this.pointer=new e(this,this.options)})}}(MSPointer=MSPointer||{});export default MSPointer;