/**
 * Minified by jsDelivr using Terser v5.19.0.
 * Original file: /npm/winbox@0.2.82/src/js/winbox.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import template from"./template.js";import{addListener,removeListener,setStyle,setText,getByClass,addClass,removeClass,hasClass,preventEvent}from"./helper.js";const use_raf=!1,stack_min=[],stack_win=[],eventOptions={capture:!0,passive:!1},eventOptionsPassive={capture:!0,passive:!0};let body,is_fullscreen,prefix_request,prefix_exit,root_w,root_h,window_clicked,id_counter=0,index_counter=10;function WinBox(t,e){if(!(this instanceof WinBox))return new WinBox(t);let i,s,o,n,r,h,d,a,c,l,m,u,f,p,x,w,_,y,v,b,g,k,C,B,W,z,L,M,q,S,O,E,F,P,N,T,R,H,j,A,I,U,X,Y;if(body||setup(),t&&(e&&(r=t,t=e),"string"==typeof t?r=t:(i=t.id,s=t.index,o=t.root,n=t.template,r=r||t.title,h=t.icon,d=t.mount,a=t.html,c=t.url,l=t.width,m=t.height,u=t.minwidth,f=t.minheight,p=t.maxwidth,x=t.maxheight,w=t.autosize,_=t.overflow,B=t.min,W=t.max,z=t.hidden,L=t.modal,y=t.x||(L?"center":0),v=t.y||(L?"center":0),b=t.top,g=t.left,k=t.bottom,C=t.right,M=t.background,q=t.border,S=t.header,O=t.class,E=t.oncreate,F=t.onclose,P=t.onfocus,N=t.onblur,T=t.onmove,R=t.onresize,H=t.onfullscreen,j=t.onmaximize,A=t.onminimize,I=t.onrestore,U=t.onhide,X=t.onshow,Y=t.onload)),this.dom=template(n),this.dom.id=this.id=i||"winbox-"+ ++id_counter,this.dom.className="winbox"+(O?" "+("string"==typeof O?O:O.join(" ")):"")+(L?" modal":""),this.dom.winbox=this,this.window=this.dom,this.body=getByClass(this.dom,"wb-body"),this.header=S||35,stack_win.push(this),M&&this.setBackground(M),q?setStyle(this.body,"margin",q+(isNaN(q)?"":"px")):q=0,S){const t=getByClass(this.dom,"wb-header");setStyle(t,"height",S+"px"),setStyle(t,"line-height",S+"px"),setStyle(this.body,"top",S+"px")}r&&this.setTitle(r),h&&this.setIcon(h),d?this.mount(d):a?this.body.innerHTML=a:c&&this.setUrl(c,Y),b=b?parse(b,root_h):0,k=k?parse(k,root_h):0,g=g?parse(g,root_w):0,C=C?parse(C,root_w):0;const D=root_w-g-C,G=root_h-b-k;p=p?parse(p,D):D,x=x?parse(x,G):G,u=u?parse(u,p):150,f=f?parse(f,x):this.header,w?((o||body).appendChild(this.body),l=Math.max(Math.min(this.body.clientWidth+2*q+1,p),u),m=Math.max(Math.min(this.body.clientHeight+this.header+q+1,x),f),this.dom.appendChild(this.body)):(l=l?parse(l,p):0|Math.max(p/2,u),m=m?parse(m,x):0|Math.max(x/2,f)),y=y?parse(y,D,l):g,v=v?parse(v,G,m):b,this.x=y,this.y=v,this.width=l,this.height=m,this.minwidth=u,this.minheight=f,this.maxwidth=p,this.maxheight=x,this.top=b,this.right=C,this.bottom=k,this.left=g,this.index=s,this.overflow=_,this.min=!1,this.max=!1,this.full=!1,this.hidden=!1,this.focused=!1,this.onclose=F,this.onfocus=P,this.onblur=N,this.onmove=T,this.onresize=R,this.onfullscreen=H,this.onmaximize=j,this.onminimize=A,this.onrestore=I,this.onhide=U,this.onshow=X,z?this.hide():this.focus(),(s||0===s)&&(this.index=s,setStyle(this.dom,"z-index",s),s>index_counter&&(index_counter=s)),W?this.maximize():B?this.minimize():this.resize().move(),register(this),(o||body).appendChild(this.dom),E&&E.call(this,t)}WinBox.new=function(t){return new WinBox(t)},WinBox.stack=function(){return stack_win};export default WinBox;function parse(t,e,i){if("string"==typeof t)if("center"===t)t=(e-i)/2+.5|0;else if("right"===t||"bottom"===t)t=e-i;else{const i=parseFloat(t),s=""+i!==t&&t.substring((""+i).length);t="%"===s?e/100*i+.5|0:i}return t}function setup(){body=document.body,body[prefix_request="requestFullscreen"]||body[prefix_request="msRequestFullscreen"]||body[prefix_request="webkitRequestFullscreen"]||body[prefix_request="mozRequestFullscreen"]||(prefix_request=""),prefix_exit=prefix_request&&prefix_request.replace("request","exit").replace("mozRequest","mozCancel").replace("Request","Exit"),addListener(window,"resize",(function(){init(),update_min_stack()})),addListener(body,"mousedown",(function(t){window_clicked=!1}),!0),addListener(body,"mousedown",(function(t){if(!window_clicked){const t=stack_win.length;if(t)for(let e=t-1;e>=0;e--){const t=stack_win[e];if(t.focused){t.blur();break}}}})),init()}function register(t){addWindowListener(t,"drag"),addWindowListener(t,"n"),addWindowListener(t,"s"),addWindowListener(t,"w"),addWindowListener(t,"e"),addWindowListener(t,"nw"),addWindowListener(t,"ne"),addWindowListener(t,"se"),addWindowListener(t,"sw"),addListener(getByClass(t.dom,"wb-min"),"click",(function(e){preventEvent(e),t.min?t.restore().focus():t.minimize()})),addListener(getByClass(t.dom,"wb-max"),"click",(function(e){preventEvent(e),t.max?t.restore().focus():t.maximize().focus()})),prefix_request?addListener(getByClass(t.dom,"wb-full"),"click",(function(e){preventEvent(e),t.fullscreen().focus()})):t.addClass("no-full"),addListener(getByClass(t.dom,"wb-close"),"click",(function(e){preventEvent(e),t.close()||(t=null)})),addListener(t.dom,"mousedown",(function(t){window_clicked=!0}),!0),addListener(t.body,"mousedown",(function(e){t.focus()}),!0)}function remove_min_stack(t){stack_min.splice(stack_min.indexOf(t),1),update_min_stack(),t.removeClass("min"),t.min=!1,t.dom.title=""}function update_min_stack(){const t=stack_min.length,e={},i={};for(let s,o,n=0;n<t;n++)s=stack_min[n],o=s.left+":"+s.top,i[o]?i[o]++:(e[o]=0,i[o]=1);for(let s,o,n,r=0;r<t;r++)s=stack_min[r],o=s.left+":"+s.top,n=Math.min((root_w-s.left-s.right)/i[o],250),s.resize(n+1|0,s.header,!0).move(s.left+e[o]*n|0,root_h-s.bottom-s.header,!0),e[o]++}function addWindowListener(t,e){const i=getByClass(t.dom,"wb-"+e);if(!i)return;let s,o,n,r,h,d,a=0;function c(){r=requestAnimationFrame(c),d&&(t.resize(),d=!1),h&&(t.move(),h=!1)}function l(i){if(preventEvent(i,!0),t.focus(),"drag"===e){if(t.min)return void t.restore();if(!t.hasClass("no-max")){const e=Date.now(),i=e-a;if(a=e,i<300)return void(t.max?t.restore():t.maximize())}}t.min||(addClass(body,"wb-lock"),use_raf&&c(),(s=i.touches)&&(s=s[0])?(i=s,addListener(window,"touchmove",m,eventOptionsPassive),addListener(window,"touchend",u,eventOptionsPassive)):(addListener(window,"mousemove",m,eventOptionsPassive),addListener(window,"mouseup",u,eventOptionsPassive)),o=i.pageX,n=i.pageY)}function m(i){preventEvent(i),s&&(i=i.touches[0]);const r=i.pageX,a=i.pageY,c=r-o,l=a-n,m=t.width,u=t.height,f=t.x,p=t.y;let x,w,_,y;if("drag"===e){if(t.hasClass("no-move"))return;t.x+=c,t.y+=l,_=y=1}else"e"===e||"se"===e||"ne"===e?(t.width+=c,x=1):"w"!==e&&"sw"!==e&&"nw"!==e||(t.x+=c,t.width-=c,x=1,_=1),"s"===e||"se"===e||"sw"===e?(t.height+=l,w=1):"n"!==e&&"ne"!==e&&"nw"!==e||(t.y+=l,t.height-=l,w=1,y=1);x&&(t.width=Math.max(Math.min(t.width,t.maxwidth,root_w-t.x-t.right),t.minwidth),x=t.width!==m),w&&(t.height=Math.max(Math.min(t.height,t.maxheight,root_h-t.y-t.bottom),t.minheight),w=t.height!==u),(x||w)&&(use_raf?d=!0:t.resize()),_&&(t.max&&(t.x=(r<root_w/3?t.left:r>root_w/3*2?root_w-t.width-t.right:root_w/2-t.width/2)+c),t.x=Math.max(Math.min(t.x,t.overflow?root_w-30:root_w-t.width-t.right),t.overflow?30-t.width:t.left),_=t.x!==f),y&&(t.max&&(t.y=t.top+l),t.y=Math.max(Math.min(t.y,t.overflow?root_h-t.header:root_h-t.height-t.bottom),t.top),y=t.y!==p),(_||y)&&(t.max&&t.restore(),use_raf?h=!0:t.move()),(x||_)&&(o=r),(w||y)&&(n=a)}function u(t){preventEvent(t),removeClass(body,"wb-lock"),use_raf&&cancelAnimationFrame(r),s?(removeListener(window,"touchmove",m,eventOptionsPassive),removeListener(window,"touchend",u,eventOptionsPassive)):(removeListener(window,"mousemove",m,eventOptionsPassive),removeListener(window,"mouseup",u,eventOptionsPassive))}addListener(i,"mousedown",l,eventOptions),addListener(i,"touchstart",l,eventOptions)}function init(){const t=document.documentElement;root_w=t.clientWidth,root_h=t.clientHeight}function focus_next(){const t=stack_win.length;if(t)for(let e=t-1;e>=0;e--){const t=stack_win[e];if(!t.min){t.focus();break}}}function has_fullscreen(){return document.fullscreen||document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement}function cancel_fullscreen(){if(is_fullscreen.full=!1,has_fullscreen())return document[prefix_exit](),!0}WinBox.prototype.mount=function(t){return this.unmount(),t._backstore||(t._backstore=t.parentNode),this.body.textContent="",this.body.appendChild(t),this},WinBox.prototype.unmount=function(t){const e=this.body.firstChild;if(e){const i=t||e._backstore;i&&i.appendChild(e),e._backstore=t}return this},WinBox.prototype.setTitle=function(t){const e=getByClass(this.dom,"wb-title");return setText(e,this.title=t),this},WinBox.prototype.setIcon=function(t){const e=getByClass(this.dom,"wb-icon");return setStyle(e,"background-image","url("+t+")"),setStyle(e,"display","inline-block"),this},WinBox.prototype.setBackground=function(t){return setStyle(this.dom,"background",t),this},WinBox.prototype.setUrl=function(t,e){const i=this.body.firstChild;return i&&"iframe"===i.tagName.toLowerCase()?i.src=t:(this.body.innerHTML='<iframe src="'+t+'"></iframe>',e&&(this.body.firstChild.onload=e)),this},WinBox.prototype.focus=function(t){if(!1===t)return this.blur();if(!this.focused){const t=stack_win.length;if(t>1)for(let e=1;e<=t;e++){const i=stack_win[t-e];if(i.focused){i.blur(),stack_win.push(stack_win.splice(stack_win.indexOf(this),1)[0]);break}}setStyle(this.dom,"z-index",++index_counter),this.index=index_counter,this.addClass("focus"),this.focused=!0,this.onfocus&&this.onfocus()}return this},WinBox.prototype.blur=function(t){return!1===t?this.focus():(this.focused&&(this.removeClass("focus"),this.focused=!1,this.onblur&&this.onblur()),this)},WinBox.prototype.hide=function(t){return!1===t?this.show():this.hidden?void 0:(this.onhide&&this.onhide(),this.hidden=!0,this.addClass("hide"))},WinBox.prototype.show=function(t){return!1===t?this.hide():this.hidden?(this.onshow&&this.onshow(),this.hidden=!1,this.removeClass("hide")):void 0},WinBox.prototype.minimize=function(t){return!1===t?this.restore():(is_fullscreen&&cancel_fullscreen(),this.max&&(this.removeClass("max"),this.max=!1),this.min||(stack_min.push(this),update_min_stack(),this.dom.title=this.title,this.addClass("min"),this.min=!0,this.focused&&(this.blur(),focus_next()),this.onminimize&&this.onminimize()),this)},WinBox.prototype.restore=function(){return is_fullscreen&&cancel_fullscreen(),this.min&&(remove_min_stack(this),this.resize().move(),this.onrestore&&this.onrestore()),this.max&&(this.max=!1,this.removeClass("max").resize().move(),this.onrestore&&this.onrestore()),this},WinBox.prototype.maximize=function(t){return!1===t?this.restore():(is_fullscreen&&cancel_fullscreen(),this.min&&remove_min_stack(this),this.max||(this.addClass("max").resize(root_w-this.left-this.right,root_h-this.top-this.bottom,!0).move(this.left,this.top,!0),this.max=!0,this.onmaximize&&this.onmaximize()),this)},WinBox.prototype.fullscreen=function(t){if(this.min&&(remove_min_stack(this),this.resize().move()),is_fullscreen&&cancel_fullscreen()){if(!1===t)return this.restore()}else this.body[prefix_request](),is_fullscreen=this,this.full=!0,this.onfullscreen&&this.onfullscreen();return this},WinBox.prototype.close=function(t){if(this.onclose&&this.onclose(t))return!0;this.min&&remove_min_stack(this),stack_win.splice(stack_win.indexOf(this),1),this.unmount(),this.dom.remove(),this.dom.textContent="",this.dom.winbox=null,this.body=null,this.dom=null,this.focused&&focus_next()},WinBox.prototype.move=function(t,e,i){return t||0===t?i||(this.x=t?t=parse(t,root_w-this.left-this.right,this.width):0,this.y=e?e=parse(e,root_h-this.top-this.bottom,this.height):0):(t=this.x,e=this.y),setStyle(this.dom,"left",t+"px"),setStyle(this.dom,"top",e+"px"),this.onmove&&this.onmove(t,e),this},WinBox.prototype.resize=function(t,e,i){return t||0===t?i||(this.width=t?t=parse(t,this.maxwidth):0,this.height=e?e=parse(e,this.maxheight):0,t=Math.max(t,this.minwidth),e=Math.max(e,this.minheight)):(t=this.width,e=this.height),setStyle(this.dom,"width",t+"px"),setStyle(this.dom,"height",e+"px"),this.onresize&&this.onresize(t,e),this},WinBox.prototype.addControl=function(t){const e=t.class,i=t.image,s=t.click,o=t.index,n=document.createElement("span"),r=getByClass(this.dom,"wb-control"),h=this;return e&&(n.className=e),i&&setStyle(n,"background-image","url("+i+")"),s&&(n.onclick=function(t){s.call(this,t,h)}),r.insertBefore(n,r.childNodes[o||0]),this},WinBox.prototype.removeControl=function(t){return(t=getByClass(this.dom,t))&&t.remove(),this},WinBox.prototype.addClass=function(t){return addClass(this.dom,t),this},WinBox.prototype.removeClass=function(t){return removeClass(this.dom,t),this},WinBox.prototype.hasClass=function(t){return hasClass(this.dom,t)},WinBox.prototype.toggleClass=function(t){return this.hasClass(t)?this.removeClass(t):this.addClass(t)};
//# sourceMappingURL=/sm/9ce3518d04fab2b8bc4319ce0d6cb8cb91a5a789f70880e87fdc70495211795f.map