---
marp: true
theme: gaia
_class: lead
footer: QCN
paginate: true
backgroundColor: #fff
---

<style>
:root {
  font-family: Pretendard;
  --border-color: #303030;
  --text-color: #0a0a0a;
  --bg-color-alt: #dadada;
  --mark-background: #ffef92;
}

h1 {
  border-bottom: none;
  font-size: 1.6em;
}

h2 {
  border-bottom: none;
  font-size: 1.3em;
}

h3 {
  font-size: 1.1em;
}

h4 {
  font-size: 1.05em;
}

h5 {
  font-size: 1em;
}

h6 {
  font-size: 0.9em;
}

h1,
h2,
h3,
h4,
h5,
h6 {
  color: var(--text-color);
}

code:not([class*="language-"]) {
  font-family: D2Coding;
  color: #000;
  vertical-align: text-bottom;
  background-color: rgba(100, 100, 100, 0.2);
}

section {
  background-image: linear-gradient(to bottom right, #f7f7f7 0%, #d3d3d3 100%);
}

section table {
    margin: auto;
    font-size: 28px;
}

section::after {
  font-size: 0.75em;
  content: attr(data-marpit-pagination) " / " attr(data-marpit-pagination-total);
}

img[alt~="center"] {
  display: block;
  margin: 0 auto;
}

blockquote {
  font-size: 26px;
  border-left: 8px solid var(--border-color);
  background: var(--bg-color-alt);
  margin: 0.5em;
  padding: 0.5em;
}

blockquote::before,
blockquote::after {
    content: '';
}

mark {
  background-color: var(--mark-background);
  padding: 0 2px 2px;
  border-radius: 4px;
  margin: 0 2px;
}

section.tinytext>p,
section.tinytext>ul,
section.tinytext>blockquote {
  font-size: 0.65em;
}
</style>

# 업무 모듈 디렉토리 깊게 파헤치기

### Areas, Controllers, Pages, Contracts

---

## API의 심장: `Controllers` 디렉토리

- 위치: `Areas/[모듈 ID]/Controllers`
- 역할: 클라이언트(웹 브라우저 등)로부터 오는 <mark>API 요청을 받아 처리</mark>하는 로직이 담겨있습니다.
- 파일: `HomeController.cs`, `BoardController.cs` 와 같은 C# 클래스 파일로 구성됩니다.
- 주로 JSON 형태의 데이터를 주고받는 RESTful API 엔드포인트를 정의합니다.

```txt
/Areas
└── Sample
    └── Controllers
        └── HomeController.cs
```

---

## `Controllers` 예시 코드

- `/api/[모듈 ID]/hello` 요청을 처리하는 간단한 예시입니다.

- `Areas/Sample/Controllers/HomeController.cs`
```csharp
using Microsoft.AspNetCore.Mvc;

namespace HandStack.Web.Areas.Sample.Controllers
{
    [Area("Sample")]
    [Route("api/[area]/[controller]")]
    public class HomeController : Controller
    {
        [HttpGet("hello")]
        public ActionResult<string> SayHello()
        {
            return "Hello from Server!";
        }
    }
}
```
- 위 코드는 `GET /api/Sample/hello` 요청 시 "Hello from Server!" 라는 텍스트를 반환합니다.

---

## 서버가 그리는 화면: `Pages` 디렉토리

- 위치: `Areas/[모듈 ID]/Pages`
- 역할: <mark>서버 측에서 렌더링</mark>되는 UI, 즉 사용자에게 보여질 화면(HTML)을 만듭니다.
- 파일: 주로 Razor Pages 기술을 사용하며, `Index.cshtml`(View)과 `Index.cshtml.cs`(Code-behind) 파일이 하나의 쌍으로 동작합니다.
- 서버의 데이터를 받아 동적인 웹 페이지를 생성할 때 사용됩니다.

```txt
/Areas
└── Sample
    └── Pages
        ├── Index.cshtml
        └── Index.cshtml.cs
```
---

## `Pages` 파일의 역할

- `Index.cshtml`
    - HTML 구조와 함께 C# 코드를 사용하여 서버 데이터를 화면에 표시합니다.
    - `@` 기호를 사용하여 C# 변수나 로직을 HTML에 삽입합니다.

- `Index.cshtml.cs` (코드 비하인드)
    - 페이지가 로드될 때 실행될 C# 로직을 담습니다.
    - 데이터베이스에서 데이터를 조회하거나, 클라이언트 요청을 처리하여 그 결과를 `cshtml` 파일로 전달합니다.

---

## 계약의 정의: `Contracts` 디렉토리

- 위치: `Areas/[모듈 ID]/Contracts`
- 역할: 모듈 간의 데이터 교환 형식이나 규칙을 정의합니다.
- 주로 <mark>DTO (Data Transfer Object)</mark>, <mark>인터페이스(Interface)</mark> 등을 정의하여 모듈 간의 의존성을 낮추고 명확한 통신을 보장합니다.

```txt
/Areas
└── Sample
    └── Contracts
        └── UserInfo.cs // 사용자 정보 DTO
```

---

## 권장 디렉토리 구조

- 모듈의 가독성과 유지보수성을 위해 다음과 같은 디렉토리 구조를 권장합니다.

- `Entity`: 데이터베이스 테이블과 매핑되는 모델 클래스
- `Events`: 비동기 처리를 위한 이벤트 정의
- `Extensions`: 기존 클래스를 확장하는 헬퍼 메서드
- `Services`: 비즈니스 로직을 처리하는 서비스 클래스
- `Settings`: 모듈별 환경 설정 값

---

## HandStack의 `ack` 서버

- `ack` 서버는 HandStack 애플리케이션의 시작점입니다.
- 이 웹 서버가 시작될 때, 필요한 `모듈`들을 로딩하여 메모리에 올립니다.
- 그 후, 클라이언트로부터 들어오는 모든 HTTP 요청(API, Page)을 적절한 `Controller`나 `Page`로 전달하고 응답을 처리하는 중심 역할을 수행합니다.

---

## 핸즈온: 로딩되는 모듈 확인하기

- `ack` 서버가 어떤 모듈을 로드하는지는 설정 파일에서 확인할 수 있습니다.
- 아래 경로의 파일을 열어 `LoadModules` 항목을 살펴봅시다.
- 지금은 각 모듈의 역할을 깊게 이해하기보다, '아, 이렇게 설정 파일에서 필요한 모듈을 관리하는구나' 정도로 이해하면 충분합니다.

- 경로: `$(HANDSTACK_SRC)/1.WebHost/ack/appsettings.json`
```json
{
  // ... 생략 ...
  "LoadModules": [
      "wwwroot",
      "transact",
      "dbclient",
      "function",
      "repository",
      "logger",
      "checkup"
  ],
  // ... 생략 ...
}
```

---

## HandStack 장점 다시보기

> HandStack은 여러분이 클라이언트와 서버에서 업무 화면과 기능을 개발 할 때 필요한 <mark>기본적인 틀과 오픈소스를 제공</mark>합니다.
>
> 덕분에 개발자는 복잡한 설정이나 기반 구조에 쏟는 시간을 줄이고, <mark>핵심 비즈니스 로직 개발에만 집중</mark>할 수 있죠!

---

## Q & A

감사합니다.