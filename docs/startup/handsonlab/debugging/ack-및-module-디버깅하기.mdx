---
sidebar_position: 2
---

# ack 및 module 디버깅하기

프로그램 디버깅은 코드에서 오류를 찾고 수정하는 과정입니다. 이는 개발자가 코드가 예상대로 작동하지 않을 때, 문제가 무엇인지 파악하고 해결하는 데 필수적인 기술입니다. 디버깅은 다음과 같은 이유로 중요합니다:

1. **오류 수정**: 디버깅은 코드에서 버그를 찾고 수정하는 데 도움이 됩니다. 이는 코드가 예상대로 작동하도록 하는 데 필수적입니다.

2. **이해도 향상**: 디버깅 과정을 통해 코드의 작동 방식을 더 잘 이해할 수 있습니다. 이는 코드의 흐름과 로직을 파악하는 데 도움이 됩니다.

3. **코드 품질 향상**: 디버깅은 코드 품질을 향상시키는 데 도움이 됩니다. 디버깅을 통해 성능 저하를 일으키는 코드 부분을 찾아 유지 관리성을 향상시킬 수 있습니다.

> 디버깅 과정은 매우 어렵습니다. 단순히 암기하거나 책을 읽는 것만으로는 디버깅을 잘 할 수 없습니다. 디버깅은 경험을 통해 배울 수 있는 기술이며 문제에 대한 성숙도와 개개인의 직관에 따라서 해결방안이 달라지기 때문입니다. 디버깅을 잘 하려면 많은 경험이 필요합니다.

그래서 고급 개발자로 나아가기 위해 그리고 팀 전체의 성공을 위해 시니어 개발자는 자신의 경험과 지식을 공유하여, 주니어 개발자가 디버깅 기술을 향상시키는 데 도움을 줘야 합니다.

ack 프로그램 장애시 로그 파일로 장애 원인을 파악할 수 없거나 개발자 PC 환경이 아닌 개발 도구가 없는 개발 및 운영 환경에서 원격으로 디버그 하여 원인을 파악 할 수 있습니다.

> 원격 디버깅은 운영체제, 프로그램, 개발 도구의 버전이 일치해야 하며, 개발자 PC와 서버에 디버깅을 수행할 수 있는 개발 도구가 설치되어 있어야 합니다. 이 주제는 많은 내용이 필요하며 향후 [12-Factors > 12.관리작업](/docs/category/12%EA%B4%80%EB%A6%AC%EC%9E%91%EC%97%85) 문서로 추가됩니다. 이 문서에는 로컬 PC에서 디버깅하는 방법을 가이드 합니다.

## ack 디버깅하기

### 사전 요구 사항

디버깅을 수행할 개발 PC

* Visual Studio .NET 2022 이상 버전 설치
* Visual Studio 설치 옵션에서 컴퓨터에서 ASP.NET 및 웹 개발 워크로드 또는 .NET Core 플랫폼 간 개발 워크로드를 설치

원격 디버깅 대상 서버
* Ubuntu 서버에서 SSH 서버를 설치
```bash
sudo apt-get install openssh-server unzip curl
```
    
* Ubuntu 서버 에서 .NET Runtime 또는 SDK 설치

* sudo 권한이 부여된 접근 계정



---
# 프로그램 디버그 준비

.NET Core 프로그램은 크게 Debug, Release 모드로 컴파일되어 배포되며, Release 모드의 컴파일은 보안 및 약간의 성능 향상을 기대할 수 있지만 Debug 모드에 비해 디버그 하기가 훨씬 어렵다.

디버깅을 해야 할 경우 개발자 PC에 있는 프로그램 파일들과 대상 서버에 배포된 파일들의 버전이 일치해야 문제없이 디버깅이 가능하기 때문에 새로운 개발 담당자가 디버그를 할 경우 최종 버전의 SVN에서 소스를 내려받아 컴파일 한 프로그램 파일들을 대상 서버에 미리 배포해두는 것이 좋다.

> 릴리스 구성을 사용해야 하는 경우 먼저 내 코드만을 사용하지 않도록 설정합니다. 이 설정을 해제하려면 도구 > 옵션 > 디버깅 을 선택한 다음 내 코드만 사용 을 선택 취소한다.

프로젝트가 이식 가능 PDB(기본 설정)를 생성하도록 구성되었는지, PDB가 DLL과 동일한 위치에 있는지 확인한 후, Visual Studio에서 이를 구성하려면 프로젝트를 마우스 오른쪽 단추로 클릭하고 속성 > 빌드 > 고급 > 디버깅 정보 를 선택한다.


## module 디버깅하기

## SSH를 이용해 Ubuntu에서 .NET Core 프로그램 디버그
Visual Studio 2017부터 SSH를 통해 로컬 또는 원격 Linux 배포에서 실행되는 .NET Core 프로세스에 연결할 수 있다. 이 문서에서는 디버깅을 설정하는 방법과 디버그하는 방법을 설명한다.

> 디버깅을 수행하면 모든 프로세스 업무가 중단되기 때문에 운영 환경과 동일한 개발 또는 테스트 환경에 작업할 수 있도록 사전에 인프라 환경을 만들어 두는 것을 권장한다.

---
# 프로그램 빌드 및 배포
디버그하기 전에 다음과 같은 방법으로 미리 앱을 배포 해야한다.
* SVN을 이용하여 소스를 대상 컴퓨터에 복사하고 Ubuntu 서버의 .NET Core SDK를 이용한 dotnet build 명령어를 수행하여 프로그램을 빌드한다.
* Windows에서 앱을 빌드한 다음 빌드 아티팩트를 Ubuntu 컴퓨터로 전송. (빌드 아티팩트는 애플리케이션 자체, 이식 가능 PDB, 종속될 수 있는 런타임 라이브러리 및 .deps.json 파일로 구성)

> 마일스톤 운영 서버에 배포되는 .NET Core 프로그램은 Visual Studio .NET에서 Debug 모드로 컴파일되어 디버깅이 가능한 pdb 파일까지 포함하는 파일들을 함께 Jenkins을 통해 배포된다.

앱이 배포가 되면 터미널에서 다음의 명령어로 프로그램을 시작한다.

```bash
dotnet Qrame.Web.MessageServer.dll
```

만약 프로그램의 시작시 장애를 확인 해야 할 경우 다음과 같이 시작 지연 (10분)을 통해 프로세스 연결을 할 시간을 벌 수 있도록 프로그램 시작을 대기 시킬수 있다. 원격 프로세스 디버깅을 연결 후 중단점을 개발자가 직접 건너뛰어 단계별 수동을 진행해야 한다.

```bash
dotnet Qrame.Web.MessageServer.dll --debug --delay=600000
```



---
# 디버거 연결

다음과 같이 Ubuntu 서버에서 실행 중인 마일스톤 프로그램을 디버거로 연결한다.
* Visual Studio에서 디버그 > 프로세스에 연결... 을 선택
* 연결 형식 목록에서 SSH 를 선택
* 연결 대상 을 대상 컴퓨터의 IP 주소 또는 호스트 이름으로 변경
* 자격 증명을 아직 입력하지 않았다면 암호 및/또는 프라이빗 키 파일을 입력하라는 메시지가 표시
* 포트 요구 사항으로는 SSH 서버가 실행 중인 포트만 구성
* 디버그 할 프로세스 이름 또는 dotnet이라는 프로세스에서 실행 중인 프로그램 찾기



---
# 참고 스크린 샷
![image](assets/개발 및 운영 서버 UI, BP, AP, FS 디버깅_1.png)
그림) 마일스톤 개발 서버에 운영중인 UI, BP, AP, FS 프로그램 목록



![image](assets/개발 및 운영 서버 UI, BP, AP, FS 디버깅_2.png)
그림) 프로세스 연결시 선택해야할 형식 디버깅



![image](assets/개발 및 운영 서버 UI, BP, AP, FS 디버깅_3.png)
그림)  Ubuntu 서버에 첫 접근시 계정 정보 입력



![image](assets/개발 및 운영 서버 UI, BP, AP, FS 디버깅_4.png)
그림) 마일스톤 AP 프로세스 연결 후 개발자 PC에서 Execute 메서드 디버깅





